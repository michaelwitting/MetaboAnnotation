<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MetaboAnnotation">
<title>Annotation of MS-based Metabolomics Data • MetaboAnnotation</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Annotation of MS-based Metabolomics Data">
<meta property="og:description" content="MetaboAnnotation">
<meta property="og:image" content="https://rformassspectrometry.github.io/MetaboAnnotation/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MetaboAnnotation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/MetaboAnnotation.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/MetaboAnnotation/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Annotation of MS-based Metabolomics Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/MetaboAnnotation/blob/HEAD/vignettes/MetaboAnnotation.Rmd" class="external-link"><code>vignettes/MetaboAnnotation.Rmd</code></a></small>
      <div class="d-none name"><code>MetaboAnnotation.Rmd</code></div>
    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><p><strong>Package</strong>: <em><a href="https://bioconductor.org/packages/3.17/MetaboAnnotation" class="external-link">MetaboAnnotation</a></em><br><strong>Authors</strong>: Michael Witting [aut] (<a href="https://orcid.org/0000-0002-1462-4426" class="external-link uri">https://orcid.org/0000-0002-1462-4426</a>), Johannes Rainer
[aut, cre] (<a href="https://orcid.org/0000-0002-6977-7147" class="external-link uri">https://orcid.org/0000-0002-6977-7147</a>), Andrea Vicini
[aut] (<a href="https://orcid.org/0000-0001-9438-6909" class="external-link uri">https://orcid.org/0000-0001-9438-6909</a>), Carolin Huber
[aut] (<a href="https://orcid.org/0000-0002-9355-8948" class="external-link uri">https://orcid.org/0000-0002-9355-8948</a>), Nir Shachaf
[ctb]<br><strong>Compiled</strong>: Wed Apr 12 11:35:29 2023</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>MetaboAnnotation</code> package defines high-level user
functionality to support and facilitate annotation of MS-based
metabolomics data <span class="citation">(Rainer et al.
2022)</span>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The package can be installed with the <code>BiocManager</code>
package. To install <code>BiocManager</code> use
<code>install.packages("BiocManager")</code> and, after that,
<code>BiocManager::install("MetaboAnnotation")</code> to install this
package.</p>
</div>
<div class="section level2">
<h2 id="general-description">General description<a class="anchor" aria-label="anchor" href="#general-description"></a>
</h2>
<p><code>MetaboAnnotation</code> provides a set of <em>matching</em>
functions that allow comparison (and matching) between <em>query</em>
and <em>target</em> entities. These entities can be chemical formulas,
numeric values (e.g. m/z or retention times) or fragment spectra. The
available matching functions are:</p>
<ul>
<li>
<code>matchFormula</code>: to match chemical formulas.</li>
<li>
<code>matchSpectra</code>: to match fragment spectra.</li>
<li>
<code>matchValues</code> (formerly <code>matchMz</code>): to match
numerical values (m/z, masses, retention times etc).</li>
</ul>
<p>For each of these matching functions <em>parameter</em> objects are
available that allow different types or matching algorithms. Refer to
the help pages for a detailed listing of these
(e.g. <code><a href="../reference/matchFormula.html">?matchFormula</a></code>, <code><a href="../reference/matchSpectra.html">?matchSpectra</a></code> or
<code><a href="../reference/matchValues.html">?matchValues</a></code>). As a result, a <code>Matched</code> (or
<code>MatchedSpectra</code>) object is returned which streamlines and
simplifies handling of the potential one-to-many (or one-to-none)
matching.</p>
</div>
<div class="section level2">
<h2 id="example-use-cases">Example use cases<a class="anchor" aria-label="anchor" href="#example-use-cases"></a>
</h2>
<p>The following sections illustrate example use cases of the
functionality provided by the <code>MetaboAnnotation</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MetaboAnnotation" class="external-link">MetaboAnnotation</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="matching-of-mz-values">Matching of m/z values<a class="anchor" aria-label="anchor" href="#matching-of-mz-values"></a>
</h3>
<p>In this section a simple matching of feature m/z values against
theoretical m/z values is performed. This is the lowest level of
confidence in metabolite annotation. However, it gives ideas about
potential metabolites that can be analyzed in further downstream
experiments and analyses.</p>
<p>The following example loads the feature table from a lipidomics
experiments and matches the measured m/z values against reference masses
from LipidMaps. Below we use a <code>data.frame</code> as
<em>reference</em> database, but a <a href="https://github.com/EuracBiomedicalResearch/CompoundDb" class="external-link"><code>CompDb</code></a>
compound database instance would also be supported.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ms1_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"MS1_example.txt"</span>,</span>
<span>                                       package <span class="op">=</span> <span class="st">"MetaboAnnotation"</span><span class="op">)</span>,</span>
<span>                           header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ms1_features</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     feature_id       mz    rtime</span></span>
<span><span class="co">## 1 Cluster_0001 102.1281 1.560147</span></span>
<span><span class="co">## 2 Cluster_0002 102.1279 2.153590</span></span>
<span><span class="co">## 3 Cluster_0003 102.1281 2.925570</span></span>
<span><span class="co">## 4 Cluster_0004 102.1281 3.419617</span></span>
<span><span class="co">## 5 Cluster_0005 102.1270 5.801039</span></span>
<span><span class="co">## 6 Cluster_0006 102.1230 8.137535</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"LipidMaps_CompDB.txt"</span>,</span>
<span>                                    package <span class="op">=</span> <span class="st">"MetaboAnnotation"</span><span class="op">)</span>,</span>
<span>                        header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">target_df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   headgroup        name exactmass    formula chain_type</span></span>
<span><span class="co">## 1       NAE  NAE 20:4;O  363.2773  C22H37NO3       even</span></span>
<span><span class="co">## 2       NAT  NAT 20:4;O  427.2392 C22H37NO5S       even</span></span>
<span><span class="co">## 3       NAE NAE 20:3;O2  381.2879  C22H39NO4       even</span></span>
<span><span class="co">## 4       NAE    NAE 20:4  347.2824  C22H37NO2       even</span></span>
<span><span class="co">## 5       NAE    NAE 18:2  323.2824  C20H37NO2       even</span></span>
<span><span class="co">## 6       NAE    NAE 18:3  321.2668  C20H35NO2       even</span></span></code></pre>
<p>For reference (target) compounds we have only the mass available. We
need to convert this mass to m/z values in order to match the m/z values
from the features (i.e. the query m/z values) against them. For this we
need to define the <em>most likely</em> ions/adducts that would be
generated from the compounds based on the ionization used in the
experiment. We assume the most abundant adducts from the compounds being
<code>"[M+H]+"</code> and <code>"[M+Na]+</code>. We next perform the
matching with the <code>matchValues</code> function providing the query
and target data as well as a parameter object (in our case a
<code>Mass2MzParam</code>) with the settings for the matching. With the
<code>Mass2MzParam</code>, the mass or target compounds get first
converted to m/z values, based on the defined adducts, and these are
then matched against the query m/z values (i.e. the m/z values for the
features). To get a full list of supported adducts the
<code>MetaboCoreUtils::adductNames(polarity = "positive")</code> or
<code>MetaboCoreUtils::adductNames(polarity = "negative")</code> can be
used). Note also, to keep the runtime of this vignette short, we match
only the first 100 features.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchValues.html">Mass2MzParam</a></span><span class="op">(</span>adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>,</span>
<span>                           tolerance <span class="op">=</span> <span class="fl">0.005</span>, ppm <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matched_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchValues.html">matchValues</a></span><span class="op">(</span><span class="va">ms1_features</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="op">]</span>, <span class="va">target_df</span>, <span class="va">parm</span><span class="op">)</span></span>
<span><span class="va">matched_features</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class Matched </span></span>
<span><span class="co">## Total number of matches: 55 </span></span>
<span><span class="co">## Number of query objects: 100 (55 matched)</span></span>
<span><span class="co">## Number of target objects: 57599 (1 matched)</span></span></code></pre>
<p>From the tested 100 features 55 were matched against at least one
target compound (all matches are against a single compound). The result
object (of type <code>Matched</code>) contains the full query data frame
and target data frames as well as the matching information. We can
access the original query data with <code>query</code> and the original
target data with <code>target</code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/Matched.html">query</a></span><span class="op">(</span><span class="va">matched_features</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     feature_id       mz    rtime</span></span>
<span><span class="co">## 1 Cluster_0001 102.1281 1.560147</span></span>
<span><span class="co">## 2 Cluster_0002 102.1279 2.153590</span></span>
<span><span class="co">## 3 Cluster_0003 102.1281 2.925570</span></span>
<span><span class="co">## 4 Cluster_0004 102.1281 3.419617</span></span>
<span><span class="co">## 5 Cluster_0005 102.1270 5.801039</span></span>
<span><span class="co">## 6 Cluster_0006 102.1230 8.137535</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/Matched.html">target</a></span><span class="op">(</span><span class="va">matched_features</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   headgroup        name exactmass    formula chain_type</span></span>
<span><span class="co">## 1       NAE  NAE 20:4;O  363.2773  C22H37NO3       even</span></span>
<span><span class="co">## 2       NAT  NAT 20:4;O  427.2392 C22H37NO5S       even</span></span>
<span><span class="co">## 3       NAE NAE 20:3;O2  381.2879  C22H39NO4       even</span></span>
<span><span class="co">## 4       NAE    NAE 20:4  347.2824  C22H37NO2       even</span></span>
<span><span class="co">## 5       NAE    NAE 18:2  323.2824  C20H37NO2       even</span></span>
<span><span class="co">## 6       NAE    NAE 18:3  321.2668  C20H35NO2       even</span></span></code></pre>
<p>Functions <code>whichQuery</code> and <code>whichTarget</code> can be
used to identify the rows in the query and target data that could be
matched:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Matched.html">whichQuery</a></span><span class="op">(</span><span class="va">matched_features</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61  62  63  64</span></span>
<span><span class="co">## [20]  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80  81  82  83</span></span>
<span><span class="co">## [39]  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Matched.html">whichTarget</a></span><span class="op">(</span><span class="va">matched_features</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3149</span></span></code></pre>
<p>The <code>colnames</code> function can be used to evaluate which
variables/columns are available in the <code>Matched</code> object.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">matched_features</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "feature_id"        "mz"                "rtime"            </span></span>
<span><span class="co">##  [4] "target_headgroup"  "target_name"       "target_exactmass" </span></span>
<span><span class="co">##  [7] "target_formula"    "target_chain_type" "adduct"           </span></span>
<span><span class="co">## [10] "score"             "ppm_error"</span></span></code></pre>
<p>These are all columns from the <code>query</code>, all columns from
the <code>target</code> (the prefix <code>"target_"</code> is added to
the original column names in <code>target</code>) and information on the
matching result (in this case columns <code>"adduct"</code>,
<code>"score"</code> and <code>"ppm_error"</code>).</p>
<p>We can extract the full matching table with <code>matchedData</code>.
This returns a <code>DataFrame</code> with all rows in <em>query</em>
the corresponding matches in <em>target</em> along with the matching
adduct (column <code>"adduct"</code>) and the difference in m/z (column
<code>"score"</code> for absolute differences and
<code>"ppm_error"</code> for the m/z relative differences). Note that if
a row in <em>query</em> matches multiple elements in <em>target</em>,
this row will be duplicated in the <code>DataFrame</code> returned by
<code>data</code>. For rows that can not be matched <code>NA</code>
values are reported.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Matched.html">matchedData</a></span><span class="op">(</span><span class="va">matched_features</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 100 rows and 11 columns</span></span>
<span><span class="co">##        feature_id        mz     rtime target_headgroup target_name</span></span>
<span><span class="co">##       &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt;      &lt;character&gt; &lt;character&gt;</span></span>
<span><span class="co">## 1   Cluster_00...   102.128   1.56015               NA          NA</span></span>
<span><span class="co">## 2   Cluster_00...   102.128   2.15359               NA          NA</span></span>
<span><span class="co">## 3   Cluster_00...   102.128   2.92557               NA          NA</span></span>
<span><span class="co">## 4   Cluster_00...   102.128   3.41962               NA          NA</span></span>
<span><span class="co">## 5   Cluster_00...   102.127   5.80104               NA          NA</span></span>
<span><span class="co">## ...           ...       ...       ...              ...         ...</span></span>
<span><span class="co">## 96  Cluster_00...   201.113   11.2722               FA  FA 10:2;O2</span></span>
<span><span class="co">## 97  Cluster_00...   201.113   11.4081               FA  FA 10:2;O2</span></span>
<span><span class="co">## 98  Cluster_00...   201.113   11.4760               FA  FA 10:2;O2</span></span>
<span><span class="co">## 99  Cluster_00...   201.114   11.5652               FA  FA 10:2;O2</span></span>
<span><span class="co">## 100 Cluster_01...   201.114   11.7752               FA  FA 10:2;O2</span></span>
<span><span class="co">##     target_exactmass target_formula target_chain_type      adduct     score</span></span>
<span><span class="co">##            &lt;numeric&gt;    &lt;character&gt;       &lt;character&gt; &lt;character&gt; &lt;numeric&gt;</span></span>
<span><span class="co">## 1                 NA             NA                NA          NA        NA</span></span>
<span><span class="co">## 2                 NA             NA                NA          NA        NA</span></span>
<span><span class="co">## 3                 NA             NA                NA          NA        NA</span></span>
<span><span class="co">## 4                 NA             NA                NA          NA        NA</span></span>
<span><span class="co">## 5                 NA             NA                NA          NA        NA</span></span>
<span><span class="co">## ...              ...            ...               ...         ...       ...</span></span>
<span><span class="co">## 96           200.105       C10H16O4              even      [M+H]+ 0.0007312</span></span>
<span><span class="co">## 97           200.105       C10H16O4              even      [M+H]+ 0.0005444</span></span>
<span><span class="co">## 98           200.105       C10H16O4              even      [M+H]+ 0.0005328</span></span>
<span><span class="co">## 99           200.105       C10H16O4              even      [M+H]+ 0.0014619</span></span>
<span><span class="co">## 100          200.105       C10H16O4              even      [M+H]+ 0.0020342</span></span>
<span><span class="co">##     ppm_error</span></span>
<span><span class="co">##     &lt;numeric&gt;</span></span>
<span><span class="co">## 1          NA</span></span>
<span><span class="co">## 2          NA</span></span>
<span><span class="co">## 3          NA</span></span>
<span><span class="co">## 4          NA</span></span>
<span><span class="co">## 5          NA</span></span>
<span><span class="co">## ...       ...</span></span>
<span><span class="co">## 96    3.63578</span></span>
<span><span class="co">## 97    2.70695</span></span>
<span><span class="co">## 98    2.64927</span></span>
<span><span class="co">## 99    7.26908</span></span>
<span><span class="co">## 100  10.11476</span></span></code></pre>
<p>Individual columns can be simply extracted with the <code>$</code>
operator:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched_features</span><span class="op">$</span><span class="va">target_name</span></span></code></pre></div>
<pre><code><span><span class="co">##   [1] NA           NA           NA           NA           NA          </span></span>
<span><span class="co">##   [6] NA           NA           NA           NA           NA          </span></span>
<span><span class="co">##  [11] NA           NA           NA           NA           NA          </span></span>
<span><span class="co">##  [16] NA           NA           NA           NA           NA          </span></span>
<span><span class="co">##  [21] NA           NA           NA           NA           NA          </span></span>
<span><span class="co">##  [26] NA           NA           NA           NA           NA          </span></span>
<span><span class="co">##  [31] NA           NA           NA           NA           NA          </span></span>
<span><span class="co">##  [36] NA           NA           NA           NA           NA          </span></span>
<span><span class="co">##  [41] NA           NA           NA           NA           NA          </span></span>
<span><span class="co">##  [46] "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2"</span></span>
<span><span class="co">##  [51] "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2"</span></span>
<span><span class="co">##  [56] "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2"</span></span>
<span><span class="co">##  [61] "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2"</span></span>
<span><span class="co">##  [66] "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2"</span></span>
<span><span class="co">##  [71] "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2"</span></span>
<span><span class="co">##  [76] "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2"</span></span>
<span><span class="co">##  [81] "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2"</span></span>
<span><span class="co">##  [86] "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2"</span></span>
<span><span class="co">##  [91] "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2"</span></span>
<span><span class="co">##  [96] "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2" "FA 10:2;O2"</span></span></code></pre>
<p><code>NA</code> is reported for query entries for which no match was
found. See also the help page for <code><a href="../reference/Matched.html">?Matched</a></code> for more details
and information. In addition to the matching of query m/z against target
exact masses as described above it would also be possible to match
directly query m/z against target m/z values by using the
<code>MzParam</code> instead of the <code>Mass2MzParam</code>.</p>
</div>
<div class="section level3">
<h3 id="matching-of-mz-and-retention-time-values">Matching of m/z and retention time values<a class="anchor" aria-label="anchor" href="#matching-of-mz-and-retention-time-values"></a>
</h3>
<p>If expected retention time values were available for the target
compounds, an annotation with higher confidence could be performed with
<code>matchValues</code> and a <code>Mass2MzRtParam</code> parameter
object. To illustrate this we randomly assign retention times from query
features to the target compounds adding also 2 seconds difference. In a
real use case the target <code>data.frame</code> would contain masses
(or m/z values) for standards along with the retention times when ions
of these standards were measured on the same LC-MS setup from which the
query data derives.</p>
<p>Below we subset our data table with the MS1 features to the first 100
rows (to keep the runtime of the vignette short).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ms1_subset</span> <span class="op">&lt;-</span> <span class="va">ms1_features</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ms1_subset</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     feature_id       mz    rtime</span></span>
<span><span class="co">## 1 Cluster_0001 102.1281 1.560147</span></span>
<span><span class="co">## 2 Cluster_0002 102.1279 2.153590</span></span>
<span><span class="co">## 3 Cluster_0003 102.1281 2.925570</span></span>
<span><span class="co">## 4 Cluster_0004 102.1281 3.419617</span></span>
<span><span class="co">## 5 Cluster_0005 102.1270 5.801039</span></span>
<span><span class="co">## 6 Cluster_0006 102.1230 8.137535</span></span></code></pre>
<p>The table contains thus retention times of the features in a column
named <code>"rtime"</code>.</p>
<p>Next we randomly assign retention times of the features to compounds
in our target data adding a deviation of 2 seconds. As described above,
in a real use case retention times are supposed to be determined by
measuring the compounds with the same LC-MS setup.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">target_df</span><span class="op">$</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">ms1_subset</span><span class="op">$</span><span class="va">rtime</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">target_df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span></span></code></pre></div>
<p>We have now retention times available for both the query and the
target data and can thus perform a matching based on m/z
<strong>and</strong> retention times. We use the
<code>Mass2MzRtParam</code> which allows us to specify (as for the
<code>Mass2MzParam</code>) the expected adducts, the maximal acceptable
m/z relative and absolute deviation as well as the maximal acceptable
(absolute) difference in retention times. We use the settings from the
previous section and allow a difference of 10 seconds in retention
times. The retention times are provided in columns named
<code>"rtime"</code> which is different from the default
(<code>"rt"</code>). We thus specify the name of the column containing
the retention times with parameter <code>rtColname</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchValues.html">Mass2MzRtParam</a></span><span class="op">(</span>adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>,</span>
<span>                       tolerance <span class="op">=</span> <span class="fl">0.005</span>, ppm <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                       toleranceRt <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">matched_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchValues.html">matchValues</a></span><span class="op">(</span><span class="va">ms1_subset</span>, <span class="va">target_df</span>, param <span class="op">=</span> <span class="va">parm</span>,</span>
<span>                                rtColname <span class="op">=</span> <span class="st">"rtime"</span><span class="op">)</span></span>
<span><span class="va">matched_features</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class Matched </span></span>
<span><span class="co">## Total number of matches: 31 </span></span>
<span><span class="co">## Number of query objects: 100 (31 matched)</span></span>
<span><span class="co">## Number of target objects: 57599 (1 matched)</span></span></code></pre>
<p>Less features were matched based on m/z and retention times.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Matched.html">matchedData</a></span><span class="op">(</span><span class="va">matched_features</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="../reference/Matched.html">whichQuery</a></span><span class="op">(</span><span class="va">matched_features</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 31 rows and 13 columns</span></span>
<span><span class="co">##        feature_id        mz     rtime target_headgroup target_name</span></span>
<span><span class="co">##       &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt;      &lt;character&gt; &lt;character&gt;</span></span>
<span><span class="co">## 1   Cluster_00...   201.113   5.87206               FA  FA 10:2;O2</span></span>
<span><span class="co">## 2   Cluster_00...   201.113   5.93346               FA  FA 10:2;O2</span></span>
<span><span class="co">## 3   Cluster_00...   201.113   6.03653               FA  FA 10:2;O2</span></span>
<span><span class="co">## 4   Cluster_00...   201.114   6.16709               FA  FA 10:2;O2</span></span>
<span><span class="co">## 5   Cluster_00...   201.113   6.31781               FA  FA 10:2;O2</span></span>
<span><span class="co">## ...           ...       ...       ...              ...         ...</span></span>
<span><span class="co">## 27  Cluster_00...   201.113   11.2722               FA  FA 10:2;O2</span></span>
<span><span class="co">## 28  Cluster_00...   201.113   11.4081               FA  FA 10:2;O2</span></span>
<span><span class="co">## 29  Cluster_00...   201.113   11.4760               FA  FA 10:2;O2</span></span>
<span><span class="co">## 30  Cluster_00...   201.114   11.5652               FA  FA 10:2;O2</span></span>
<span><span class="co">## 31  Cluster_01...   201.114   11.7752               FA  FA 10:2;O2</span></span>
<span><span class="co">##     target_exactmass target_formula target_chain_type target_rtime      adduct</span></span>
<span><span class="co">##            &lt;numeric&gt;    &lt;character&gt;       &lt;character&gt;    &lt;numeric&gt; &lt;character&gt;</span></span>
<span><span class="co">## 1            200.105       C10H16O4              even      15.8624      [M+H]+</span></span>
<span><span class="co">## 2            200.105       C10H16O4              even      15.8624      [M+H]+</span></span>
<span><span class="co">## 3            200.105       C10H16O4              even      15.8624      [M+H]+</span></span>
<span><span class="co">## 4            200.105       C10H16O4              even      15.8624      [M+H]+</span></span>
<span><span class="co">## 5            200.105       C10H16O4              even      15.8624      [M+H]+</span></span>
<span><span class="co">## ...              ...            ...               ...          ...         ...</span></span>
<span><span class="co">## 27           200.105       C10H16O4              even      15.8624      [M+H]+</span></span>
<span><span class="co">## 28           200.105       C10H16O4              even      15.8624      [M+H]+</span></span>
<span><span class="co">## 29           200.105       C10H16O4              even      15.8624      [M+H]+</span></span>
<span><span class="co">## 30           200.105       C10H16O4              even      15.8624      [M+H]+</span></span>
<span><span class="co">## 31           200.105       C10H16O4              even      15.8624      [M+H]+</span></span>
<span><span class="co">##         score ppm_error  score_rt</span></span>
<span><span class="co">##     &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span><span class="co">## 1   0.0004538   2.25645  -9.99030</span></span>
<span><span class="co">## 2   0.0004407   2.19131  -9.92890</span></span>
<span><span class="co">## 3   0.0005655   2.81186  -9.82583</span></span>
<span><span class="co">## 4   0.0015560   7.73698  -9.69527</span></span>
<span><span class="co">## 5   0.0006845   3.40357  -9.54455</span></span>
<span><span class="co">## ...       ...       ...       ...</span></span>
<span><span class="co">## 27  0.0007312   3.63578  -4.59014</span></span>
<span><span class="co">## 28  0.0005444   2.70695  -4.45431</span></span>
<span><span class="co">## 29  0.0005328   2.64927  -4.38634</span></span>
<span><span class="co">## 30  0.0014619   7.26908  -4.29719</span></span>
<span><span class="co">## 31  0.0020342  10.11476  -4.08719</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="matching-of-summarizedexperiment-or-qfeatures-objects">Matching of <code>SummarizedExperiment</code> or
<code>QFeatures</code> objects<a class="anchor" aria-label="anchor" href="#matching-of-summarizedexperiment-or-qfeatures-objects"></a>
</h3>
<p>Results from LC-MS preprocessing (e.g. by the <em><a href="https://bioconductor.org/packages/3.17/xcms" class="external-link">xcms</a></em>
package) or generally metabolomics results might be best represented and
bundled as <code>SummarizedExperiment</code> or <code>QFeatures</code>
objects (from the same-named Bioconductor packages). A
<code>XCMSnExp</code> preprocessing result from <code>xcms</code> can
for example be converted to a <code>SummarizedExperiment</code> using
the <code>quantify</code> method from the <code>xcms</code> package. The
feature definitions (i.e. their m/z and retention time values) will then
be stored in the object’s <code>rowData</code> while the assay (the
numerical matrix) will contain the feature abundances across all
samples. Such <code>SummarizedExperiment</code> objects can be simply
passed as <code>query</code> objects to the <code>matchValues</code>
method. To illustrate this, we create below a simple
<code>SummarizedExperiment</code> using the <code>ms1_features</code>
data frame from the example above as <code>rowData</code> and adding a
<code>matrix</code> with random values as assay.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/SummarizedExperiment" class="external-link">SummarizedExperiment</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: MatrixGenerics</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: matrixStats</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'MatrixGenerics'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:matrixStats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,</span></span>
<span><span class="co">##     colCounts, colCummaxs, colCummins, colCumprods, colCumsums,</span></span>
<span><span class="co">##     colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,</span></span>
<span><span class="co">##     colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,</span></span>
<span><span class="co">##     colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,</span></span>
<span><span class="co">##     colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,</span></span>
<span><span class="co">##     colWeightedMeans, colWeightedMedians, colWeightedSds,</span></span>
<span><span class="co">##     colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,</span></span>
<span><span class="co">##     rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,</span></span>
<span><span class="co">##     rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,</span></span>
<span><span class="co">##     rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,</span></span>
<span><span class="co">##     rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,</span></span>
<span><span class="co">##     rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,</span></span>
<span><span class="co">##     rowWeightedMads, rowWeightedMeans, rowWeightedMedians,</span></span>
<span><span class="co">##     rowWeightedSds, rowWeightedVars</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: GenomicRanges</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: IRanges</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: GenomeInfoDb</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: Biobase</span></span></code></pre>
<pre><code><span><span class="co">## Welcome to Bioconductor</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Vignettes contain introductory material; view with</span></span>
<span><span class="co">##     'browseVignettes()'. To cite Bioconductor, see</span></span>
<span><span class="co">##     'citation("Biobase")', and for packages 'citation("pkgname")'.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'Biobase'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:MatrixGenerics':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     rowMedians</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:matrixStats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     anyMissing, rowMedians</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:AnnotationHub':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     cache</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/RangedSummarizedExperiment-class.html" class="external-link">SummarizedExperiment</a></span><span class="op">(</span></span>
<span>    assays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ms1_features</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    rowData <span class="op">=</span> <span class="va">ms1_features</span><span class="op">)</span></span></code></pre></div>
<p>We can now use the same <code>matchValues</code> call as before to
perform the matching. Matching will be performed on the object’s
<code>rowData</code>, i.e. each row/element of the
<code>SummarizedExperiment</code> will be matched against the target
using e.g. m/z values available in columns of the object’s
<code>rowData</code>:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchValues.html">Mass2MzParam</a></span><span class="op">(</span>adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>,</span>
<span>                     tolerance <span class="op">=</span> <span class="fl">0.005</span>, ppm <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">matched_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchValues.html">matchValues</a></span><span class="op">(</span><span class="va">se</span>, <span class="va">target_df</span>, param <span class="op">=</span> <span class="va">parm</span><span class="op">)</span></span>
<span><span class="va">matched_features</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class Matched </span></span>
<span><span class="co">## Total number of matches: 9173 </span></span>
<span><span class="co">## Number of query objects: 2842 (1969 matched)</span></span>
<span><span class="co">## Number of target objects: 57599 (3296 matched)</span></span></code></pre>
<p>As <code>query</code>, the result contains the full
<code>SummarizedExperiment</code>, but <code>colnames</code> and
<code>matchedData</code> will access the respective information from the
<code>rowData</code> of this <code>SummarizedExperiment</code>:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">matched_features</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "feature_id"        "mz"                "rtime"            </span></span>
<span><span class="co">##  [4] "target_headgroup"  "target_name"       "target_exactmass" </span></span>
<span><span class="co">##  [7] "target_formula"    "target_chain_type" "target_rtime"     </span></span>
<span><span class="co">## [10] "adduct"            "score"             "ppm_error"</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Matched.html">matchedData</a></span><span class="op">(</span><span class="va">matched_features</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 10046 rows and 12 columns</span></span>
<span><span class="co">##          feature_id        mz     rtime target_headgroup   target_name</span></span>
<span><span class="co">##         &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt;      &lt;character&gt;   &lt;character&gt;</span></span>
<span><span class="co">## 1     Cluster_00...   102.128   1.56015               NA            NA</span></span>
<span><span class="co">## 2     Cluster_00...   102.128   2.15359               NA            NA</span></span>
<span><span class="co">## 3     Cluster_00...   102.128   2.92557               NA            NA</span></span>
<span><span class="co">## 4     Cluster_00...   102.128   3.41962               NA            NA</span></span>
<span><span class="co">## 5     Cluster_00...   102.127   5.80104               NA            NA</span></span>
<span><span class="co">## ...             ...       ...       ...              ...           ...</span></span>
<span><span class="co">## 10042 Cluster_28...   957.771   20.2705               TG    TG 54:2;O3</span></span>
<span><span class="co">## 10043 Cluster_28...   960.791   20.8865           HexCer HexCer 52:...</span></span>
<span><span class="co">## 10044 Cluster_28...   961.361   13.0214               NA            NA</span></span>
<span><span class="co">## 10045 Cluster_28...   970.873   22.0981             ACer ACer 60:1;...</span></span>
<span><span class="co">## 10046 Cluster_28...   972.734   15.6914          Hex2Cer Hex2Cer 42...</span></span>
<span><span class="co">##       target_exactmass target_formula target_chain_type target_rtime</span></span>
<span><span class="co">##              &lt;numeric&gt;    &lt;character&gt;       &lt;character&gt;    &lt;numeric&gt;</span></span>
<span><span class="co">## 1                   NA             NA                NA           NA</span></span>
<span><span class="co">## 2                   NA             NA                NA           NA</span></span>
<span><span class="co">## 3                   NA             NA                NA           NA</span></span>
<span><span class="co">## 4                   NA             NA                NA           NA</span></span>
<span><span class="co">## 5                   NA             NA                NA           NA</span></span>
<span><span class="co">## ...                ...            ...               ...          ...</span></span>
<span><span class="co">## 10042          934.784      C57H106O9              even      15.9950</span></span>
<span><span class="co">## 10043          959.779     C58H105NO9              even      10.5076</span></span>
<span><span class="co">## 10044               NA             NA                NA           NA</span></span>
<span><span class="co">## 10045          947.888     C60H117NO6              even       4.2806</span></span>
<span><span class="co">## 10046          971.727  C54H101NO1...              even      19.7329</span></span>
<span><span class="co">##            adduct      score ppm_error</span></span>
<span><span class="co">##       &lt;character&gt;  &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span><span class="co">## 1              NA         NA        NA</span></span>
<span><span class="co">## 2              NA         NA        NA</span></span>
<span><span class="co">## 3              NA         NA        NA</span></span>
<span><span class="co">## 4              NA         NA        NA</span></span>
<span><span class="co">## 5              NA         NA        NA</span></span>
<span><span class="co">## ...           ...        ...       ...</span></span>
<span><span class="co">## 10042     [M+Na]+ -0.0021897  2.286241</span></span>
<span><span class="co">## 10043      [M+H]+  0.0045398  4.725089</span></span>
<span><span class="co">## 10044          NA         NA        NA</span></span>
<span><span class="co">## 10045     [M+Na]+ -0.0045054  4.640545</span></span>
<span><span class="co">## 10046      [M+H]+ -0.0004240  0.435885</span></span></code></pre>
<p>Subsetting the result object, to e.g. just matched elements will also
subset the <code>SummarizedExperiment</code>.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched_sub</span> <span class="op">&lt;-</span> <span class="va">matched_features</span><span class="op">[</span><span class="fu"><a href="../reference/Matched.html">whichQuery</a></span><span class="op">(</span><span class="va">matched_features</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/Matched.html">query</a></span><span class="op">(</span><span class="va">matched_sub</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## class: SummarizedExperiment </span></span>
<span><span class="co">## dim: 1969 4 </span></span>
<span><span class="co">## metadata(0):</span></span>
<span><span class="co">## assays(1): ''</span></span>
<span><span class="co">## rownames: NULL</span></span>
<span><span class="co">## rowData names(3): feature_id mz rtime</span></span>
<span><span class="co">## colnames: NULL</span></span>
<span><span class="co">## colData names(0):</span></span></code></pre>
<p>A <code>QFeatures</code> object is essentially a container for
several <code>SummarizedExperiment</code> objects which rows (features)
are related with each other. Such an object could thus for example
contain the full feature data from an LC-MS experiment as one assay and
a compounded feature data in which data from ions of the same compound
are aggregated as an additional assay. Below we create such an object
using our <code>SummarizedExperiment</code> as an assay of name
<code>"features"</code>. For now we don’t add any additional assay to
that <code>QFeatures</code>, thus, the object contains only this single
data set.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/QFeatures" class="external-link">QFeatures</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: MultiAssayExperiment</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'QFeatures'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:MultiAssayExperiment':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     longFormat</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     sweep</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/QFeatures/man/QFeatures-class.html" class="external-link">QFeatures</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>features <span class="op">=</span> <span class="va">se</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">qf</span></span></code></pre></div>
<pre><code><span><span class="co">## An instance of class QFeatures containing 1 assays:</span></span>
<span><span class="co">##  [1] features: SummarizedExperiment with 2842 rows and 4 columns</span></span></code></pre>
<p><code>matchValues</code> supports also matching of
<code>QFeatures</code> objects but the user needs to define the assay
which should be used for the matching with the <code>queryAssay</code>
parameter.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched_qf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchValues.html">matchValues</a></span><span class="op">(</span><span class="va">qf</span>, <span class="va">target_df</span>, param <span class="op">=</span> <span class="va">parm</span>, queryAssay <span class="op">=</span> <span class="st">"features"</span><span class="op">)</span></span>
<span><span class="va">matched_qf</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class Matched </span></span>
<span><span class="co">## Total number of matches: 9173 </span></span>
<span><span class="co">## Number of query objects: 2842 (1969 matched)</span></span>
<span><span class="co">## Number of target objects: 57599 (3296 matched)</span></span></code></pre>
<p><code>colnames</code> and <code>matchedData</code> allow to access
the <code>rowData</code> of the <code>SummarizedExperiment</code> stored
in the <code>QFeatures</code>’ <code>"features"</code> assay:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">matched_qf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "feature_id"        "mz"                "rtime"            </span></span>
<span><span class="co">##  [4] "target_headgroup"  "target_name"       "target_exactmass" </span></span>
<span><span class="co">##  [7] "target_formula"    "target_chain_type" "target_rtime"     </span></span>
<span><span class="co">## [10] "adduct"            "score"             "ppm_error"</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Matched.html">matchedData</a></span><span class="op">(</span><span class="va">matched_qf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 10046 rows and 12 columns</span></span>
<span><span class="co">##          feature_id        mz     rtime target_headgroup   target_name</span></span>
<span><span class="co">##         &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt;      &lt;character&gt;   &lt;character&gt;</span></span>
<span><span class="co">## 1     Cluster_00...   102.128   1.56015               NA            NA</span></span>
<span><span class="co">## 2     Cluster_00...   102.128   2.15359               NA            NA</span></span>
<span><span class="co">## 3     Cluster_00...   102.128   2.92557               NA            NA</span></span>
<span><span class="co">## 4     Cluster_00...   102.128   3.41962               NA            NA</span></span>
<span><span class="co">## 5     Cluster_00...   102.127   5.80104               NA            NA</span></span>
<span><span class="co">## ...             ...       ...       ...              ...           ...</span></span>
<span><span class="co">## 10042 Cluster_28...   957.771   20.2705               TG    TG 54:2;O3</span></span>
<span><span class="co">## 10043 Cluster_28...   960.791   20.8865           HexCer HexCer 52:...</span></span>
<span><span class="co">## 10044 Cluster_28...   961.361   13.0214               NA            NA</span></span>
<span><span class="co">## 10045 Cluster_28...   970.873   22.0981             ACer ACer 60:1;...</span></span>
<span><span class="co">## 10046 Cluster_28...   972.734   15.6914          Hex2Cer Hex2Cer 42...</span></span>
<span><span class="co">##       target_exactmass target_formula target_chain_type target_rtime</span></span>
<span><span class="co">##              &lt;numeric&gt;    &lt;character&gt;       &lt;character&gt;    &lt;numeric&gt;</span></span>
<span><span class="co">## 1                   NA             NA                NA           NA</span></span>
<span><span class="co">## 2                   NA             NA                NA           NA</span></span>
<span><span class="co">## 3                   NA             NA                NA           NA</span></span>
<span><span class="co">## 4                   NA             NA                NA           NA</span></span>
<span><span class="co">## 5                   NA             NA                NA           NA</span></span>
<span><span class="co">## ...                ...            ...               ...          ...</span></span>
<span><span class="co">## 10042          934.784      C57H106O9              even      15.9950</span></span>
<span><span class="co">## 10043          959.779     C58H105NO9              even      10.5076</span></span>
<span><span class="co">## 10044               NA             NA                NA           NA</span></span>
<span><span class="co">## 10045          947.888     C60H117NO6              even       4.2806</span></span>
<span><span class="co">## 10046          971.727  C54H101NO1...              even      19.7329</span></span>
<span><span class="co">##            adduct      score ppm_error</span></span>
<span><span class="co">##       &lt;character&gt;  &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span><span class="co">## 1              NA         NA        NA</span></span>
<span><span class="co">## 2              NA         NA        NA</span></span>
<span><span class="co">## 3              NA         NA        NA</span></span>
<span><span class="co">## 4              NA         NA        NA</span></span>
<span><span class="co">## 5              NA         NA        NA</span></span>
<span><span class="co">## ...           ...        ...       ...</span></span>
<span><span class="co">## 10042     [M+Na]+ -0.0021897  2.286241</span></span>
<span><span class="co">## 10043      [M+H]+  0.0045398  4.725089</span></span>
<span><span class="co">## 10044          NA         NA        NA</span></span>
<span><span class="co">## 10045     [M+Na]+ -0.0045054  4.640545</span></span>
<span><span class="co">## 10046      [M+H]+ -0.0004240  0.435885</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="matching-of-msms-spectra">Matching of MS/MS spectra<a class="anchor" aria-label="anchor" href="#matching-of-msms-spectra"></a>
</h3>
<p>In this section we match experimental MS/MS spectra against reference
spectra. This can also be performed with functions from the <em><a href="https://bioconductor.org/packages/3.17/Spectra" class="external-link">Spectra</a></em>
package (see <a href="https://jorainer.github.io/SpectraTutorials/" class="external-link">SpectraTutorials</a>,
but the functions and concepts used here are more suitable to the
<em>end user</em> as they simplify the handling of the spectra matching
results.</p>
<p>Below we load spectra from a file from a reversed-phase (DDA)
LC-MS/MS run of the Agilent Pesticide mix. With
<code>filterMsLevel</code> we subset the data set to only MS2 spectra.
To reduce processing time of the example we further subset the
<code>Spectra</code> to a small set of selected MS2 spectra. In addition
we assign <em>feature identifiers</em> to each spectrum (again, for this
example these are arbitrary IDs, but in a <em>real</em> data analysis
such identifiers could indicate to which LC-MS feature these spectra
belong).</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/Spectra" class="external-link">Spectra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">msdata</span><span class="op">)</span></span>
<span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"TripleTOF-SWATH"</span>, <span class="st">"PestMix1_DDA.mzML"</span>, package <span class="op">=</span> <span class="st">"msdata"</span><span class="op">)</span></span>
<span><span class="va">pest_ms2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">filterMsLevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span>, <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="co">## subset to selected spectra.</span></span>
<span><span class="va">pest_ms2</span> <span class="op">&lt;-</span> <span class="va">pest_ms2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">808</span>, <span class="fl">809</span>, <span class="fl">945</span><span class="op">:</span><span class="fl">955</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## assign arbitrary *feature IDs* to each spectrum.</span></span>
<span><span class="va">pest_ms2</span><span class="op">$</span><span class="va">feature_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FT001"</span>, <span class="st">"FT001"</span>, <span class="st">"FT002"</span>, <span class="st">"FT003"</span>, <span class="st">"FT003"</span>, <span class="st">"FT003"</span>,</span>
<span>                         <span class="st">"FT004"</span>, <span class="st">"FT004"</span>, <span class="st">"FT004"</span>, <span class="st">"FT005"</span>, <span class="st">"FT005"</span>, <span class="st">"FT006"</span>,</span>
<span>                         <span class="st">"FT006"</span><span class="op">)</span></span>
<span><span class="co">## assign also *spectra IDs* to each</span></span>
<span><span class="va">pest_ms2</span><span class="op">$</span><span class="va">spectrum_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sp_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pest_ms2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pest_ms2</span></span></code></pre></div>
<pre><code><span><span class="co">## MSn data (Spectra) with 13 spectra in a MsBackendMzR backend:</span></span>
<span><span class="co">##       msLevel     rtime scanIndex</span></span>
<span><span class="co">##     &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1           2   361.651      2853</span></span>
<span><span class="co">## 2           2   361.741      2854</span></span>
<span><span class="co">## 3           2   377.609      3030</span></span>
<span><span class="co">## 4           2   377.699      3031</span></span>
<span><span class="co">## 5           2   378.120      3033</span></span>
<span><span class="co">## ...       ...       ...       ...</span></span>
<span><span class="co">## 9           2   378.959      3039</span></span>
<span><span class="co">## 10          2   379.379      3041</span></span>
<span><span class="co">## 11          2   380.059      3045</span></span>
<span><span class="co">## 12          2   380.609      3048</span></span>
<span><span class="co">## 13          2   381.029      3050</span></span>
<span><span class="co">##  ... 35 more variables/columns.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## file(s):</span></span>
<span><span class="co">## PestMix1_DDA.mzML</span></span>
<span><span class="co">## Processing:</span></span>
<span><span class="co">##  Filter: select MS level(s) 2 [Wed Apr 12 11:35:57 2023]</span></span></code></pre>
<p>This <code>Spectra</code> should now represent MS2 spectra associated
with LC-MS features from an untargeted LC-MS/MS experiment that we would
like to annotate by matching them against a spectral reference
library.</p>
<p>We thus load below a <code>Spectra</code> object that represents MS2
data from a very small subset of <a href="https://massbank.eu/MassBank/" class="external-link">MassBank</a> release
<em>2021.03</em>. This small <code>Spectra</code> object is provided
within this package but it would be possible to use any other
<code>Spectra</code> object with reference fragment spectra instead (see
also the <a href="https://jorainer.github.io/SpectraTutorials/" class="external-link">SpectraTutorials</a>
workshop). As an alternative, it would also be possible to use a
<code>CompDb</code> object representing a compound annotation database
(defined in the <em><a href="https://bioconductor.org/packages/3.17/CompoundDb" class="external-link">CompoundDb</a></em>
package) with parameter <code>target</code>. See the
<code>matchSpectra</code> help page or section <em>Query against
multiple reference databases</em> below for more details and options to
retrieve such annotation resources from Bioconductor’s <em><a href="https://bioconductor.org/packages/3.17/AnnotationHub" class="external-link">AnnotationHub</a></em>.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"minimb.RData"</span>, package <span class="op">=</span> <span class="st">"MetaboAnnotation"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">minimb</span></span></code></pre></div>
<pre><code><span><span class="co">## MSn data (Spectra) with 100 spectra in a MsBackendDataFrame backend:</span></span>
<span><span class="co">##       msLevel     rtime scanIndex</span></span>
<span><span class="co">##     &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1           2        NA        NA</span></span>
<span><span class="co">## 2           2        NA        NA</span></span>
<span><span class="co">## 3           2        NA        NA</span></span>
<span><span class="co">## 4           2        NA        NA</span></span>
<span><span class="co">## 5           2        NA        NA</span></span>
<span><span class="co">## ...       ...       ...       ...</span></span>
<span><span class="co">## 96         NA        NA        NA</span></span>
<span><span class="co">## 97          2        NA        NA</span></span>
<span><span class="co">## 98          2        NA        NA</span></span>
<span><span class="co">## 99          2        NA        NA</span></span>
<span><span class="co">## 100         2        NA        NA</span></span>
<span><span class="co">##  ... 42 more variables/columns.</span></span>
<span><span class="co">## Processing:</span></span>
<span><span class="co">##  Filter: select spectra with polarity 1 [Wed Mar 31 10:06:28 2021]</span></span>
<span><span class="co">##  Switch backend from MsBackendMassbankSql to MsBackendDataFrame [Wed Mar 31 10:07:59 2021]</span></span></code></pre>
<p>We can now use the <code>matchSpectra</code> function to match each
of our experimental <em>query</em> spectra against the <em>target</em>
(reference) spectra. Settings for this matching can be defined with a
dedicated <em>param</em> object. We use below the
<code>CompareSpectraParam</code> that uses the
<code>compareSpectra</code> function from the <code>Spectra</code>
package to calculate similarities between each query spectrum and all
target spectra. <code>CompareSpectraParam</code> allows to set all
individual settings for the <code>compareSpectra</code> call with
parameters <code>MAPFUN</code>, <code>ppm</code>, <code>tolerance</code>
and <code>FUN</code> (see the help on <code>compareSpectra</code> in the
<em><a href="https://bioconductor.org/packages/3.17/Spectra" class="external-link">Spectra</a></em>
package for more details). In addition, we can <em>pre-filter</em> the
target spectra for each individual query spectrum to speed-up the
calculations. By setting <code>requirePrecursor = TRUE</code> we compare
below each query spectrum only to target spectra with matching precursor
m/z (accepting a deviation defined by parameters <code>ppm</code> and
<code>tolerance</code>). By default, <code>matchSpectra</code> with
<code>CompareSpectraParam</code> considers spectra with a similarity
score higher than 0.7 as <em>matching</em> and these are thus
reported.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">csp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompareSpectraParam.html">CompareSpectraParam</a></span><span class="op">(</span>requirePrecursor <span class="op">=</span> <span class="cn">TRUE</span>, ppm <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">mtches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchSpectra.html">matchSpectra</a></span><span class="op">(</span><span class="va">pest_ms2</span>, <span class="va">minimb</span>, param <span class="op">=</span> <span class="va">csp</span><span class="op">)</span></span>
<span><span class="va">mtches</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class MatchedSpectra </span></span>
<span><span class="co">## Total number of matches: 16 </span></span>
<span><span class="co">## Number of query objects: 13 (5 matched)</span></span>
<span><span class="co">## Number of target objects: 100 (11 matched)</span></span></code></pre>
<p>The results are reported as a <code>MatchedSpectra</code> object
which represents the matching results for all query spectra. This type
of object contains all query spectra, all target spectra, the matching
information and the parameter object with the settings of the matching.
The object can be subsetted to e.g. matching results for a specific
query spectrum:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtches</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class MatchedSpectra </span></span>
<span><span class="co">## Total number of matches: 0 </span></span>
<span><span class="co">## Number of query objects: 1 (0 matched)</span></span>
<span><span class="co">## Number of target objects: 100 (0 matched)</span></span></code></pre>
<p>In this case, for the first query spectrum, no match was found among
the target spectra. Below we subset the <code>MatchedSpectra</code> to
results for the second query spectrum:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtches</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class MatchedSpectra </span></span>
<span><span class="co">## Total number of matches: 4 </span></span>
<span><span class="co">## Number of query objects: 1 (1 matched)</span></span>
<span><span class="co">## Number of target objects: 100 (4 matched)</span></span></code></pre>
<p>The second query spectrum could be matched to 4 target spectra. The
matching between query and target spectra can be n:m, i.e. each query
spectrum can match no or multiple target spectra and each target
spectrum can be matched to none, one or multiple query spectra.</p>
<p>Data (spectra variables of either the query and/or the target
spectra) can be extracted from the result object with the
<code>spectraData</code> function or with <code>$</code> (similar to a
<code>Spectra</code> object). The <code>spectraVariables</code> function
can be used to list all available spectra variables in the result
object:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">mtches</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "msLevel"                        "rtime"                         </span></span>
<span><span class="co">##  [3] "acquisitionNum"                 "scanIndex"                     </span></span>
<span><span class="co">##  [5] "dataStorage"                    "dataOrigin"                    </span></span>
<span><span class="co">##  [7] "centroided"                     "smoothed"                      </span></span>
<span><span class="co">##  [9] "polarity"                       "precScanNum"                   </span></span>
<span><span class="co">## [11] "precursorMz"                    "precursorIntensity"            </span></span>
<span><span class="co">## [13] "precursorCharge"                "collisionEnergy"               </span></span>
<span><span class="co">## [15] "isolationWindowLowerMz"         "isolationWindowTargetMz"       </span></span>
<span><span class="co">## [17] "isolationWindowUpperMz"         "peaksCount"                    </span></span>
<span><span class="co">## [19] "totIonCurrent"                  "basePeakMZ"                    </span></span>
<span><span class="co">## [21] "basePeakIntensity"              "ionisationEnergy"              </span></span>
<span><span class="co">## [23] "lowMZ"                          "highMZ"                        </span></span>
<span><span class="co">## [25] "mergedScan"                     "mergedResultScanNum"           </span></span>
<span><span class="co">## [27] "mergedResultStartScanNum"       "mergedResultEndScanNum"        </span></span>
<span><span class="co">## [29] "injectionTime"                  "filterString"                  </span></span>
<span><span class="co">## [31] "spectrumId"                     "ionMobilityDriftTime"          </span></span>
<span><span class="co">## [33] "scanWindowLowerLimit"           "scanWindowUpperLimit"          </span></span>
<span><span class="co">## [35] "feature_id"                     "spectrum_id"                   </span></span>
<span><span class="co">## [37] "target_msLevel"                 "target_rtime"                  </span></span>
<span><span class="co">## [39] "target_acquisitionNum"          "target_scanIndex"              </span></span>
<span><span class="co">## [41] "target_dataStorage"             "target_dataOrigin"             </span></span>
<span><span class="co">## [43] "target_centroided"              "target_smoothed"               </span></span>
<span><span class="co">## [45] "target_polarity"                "target_precScanNum"            </span></span>
<span><span class="co">## [47] "target_precursorMz"             "target_precursorIntensity"     </span></span>
<span><span class="co">## [49] "target_precursorCharge"         "target_collisionEnergy"        </span></span>
<span><span class="co">## [51] "target_isolationWindowLowerMz"  "target_isolationWindowTargetMz"</span></span>
<span><span class="co">## [53] "target_isolationWindowUpperMz"  "target_spectrum_id"            </span></span>
<span><span class="co">## [55] "target_spectrum_name"           "target_date"                   </span></span>
<span><span class="co">## [57] "target_authors"                 "target_license"                </span></span>
<span><span class="co">## [59] "target_copyright"               "target_publication"            </span></span>
<span><span class="co">## [61] "target_splash"                  "target_compound_id"            </span></span>
<span><span class="co">## [63] "target_adduct"                  "target_ionization"             </span></span>
<span><span class="co">## [65] "target_ionization_voltage"      "target_fragmentation_mode"     </span></span>
<span><span class="co">## [67] "target_collision_energy_text"   "target_instrument"             </span></span>
<span><span class="co">## [69] "target_instrument_type"         "target_formula"                </span></span>
<span><span class="co">## [71] "target_exactmass"               "target_smiles"                 </span></span>
<span><span class="co">## [73] "target_inchi"                   "target_inchikey"               </span></span>
<span><span class="co">## [75] "target_cas"                     "target_pubchem"                </span></span>
<span><span class="co">## [77] "target_synonym"                 "target_precursor_mz_text"      </span></span>
<span><span class="co">## [79] "target_compound_name"           "score"</span></span></code></pre>
<p>This lists the spectra variables from both the <em>query</em>
<strong>and</strong> the <em>target</em> spectra, with the prefix
<code>"target_"</code> being used for spectra variable names of the
target spectra. Spectra variable <code>"score"</code> contains the
similarity score.</p>
<p>We could thus use <code>$target_compound_name</code> to extract the
compound name of the matching target spectra for the second query
spectrum:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtches</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">$</span><span class="va">target_compound_name</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Azaconazole" "Azaconazole" "Azaconazole" "Azaconazole"</span></span></code></pre>
<p>The same information can also be extracted on the <em>full</em>
<code>MatchedSpectra</code>. Below we use <code>$spectrum_id</code> to
extract the query spectra identifiers we added above from the full
result object.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtches</span><span class="op">$</span><span class="va">spectrum_id</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "sp_1"  "sp_2"  "sp_2"  "sp_2"  "sp_2"  "sp_3"  "sp_4"  "sp_4"  "sp_5" </span></span>
<span><span class="co">## [10] "sp_6"  "sp_6"  "sp_6"  "sp_7"  "sp_8"  "sp_8"  "sp_8"  "sp_8"  "sp_8" </span></span>
<span><span class="co">## [19] "sp_9"  "sp_9"  "sp_10" "sp_11" "sp_12" "sp_13"</span></span></code></pre>
<p>Because of the n:m mapping between query and target spectra, the
number of values returned by <code>$</code> (or
<code>spectraData</code>) can be larger than the total number of query
spectra. Also in the example above, some of the spectra IDs are present
more than once in the result returned by <code>$spectrum_id</code>. The
respective spectra could be matched to more than one target spectrum
(based on our settings) and hence their IDs are reported multiple times.
Both <code>spectraData</code> and <code>$</code> for
<code>MatchedSpectra</code> use a <em>left join</em> strategy to
report/return values: a value (row) is reported for each query spectrum
(even if it does <strong>not</strong> match any target spectrum) with
eventually duplicated values (rows) if the query spectrum matches more
than one target spectrum (each value for a query spectrum is repeated as
many times as it matches target spectra). To illustrate this we use
below the <code>spectraData</code> function to extract specific data
from our result object, i.e. the spectrum and feature IDs for the query
spectra we defined above, the MS2 spectra similarity score, and the
target spectra’s ID and compound name.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtches_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">mtches</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spectrum_id"</span>, <span class="st">"feature_id"</span>,</span>
<span>                                             <span class="st">"score"</span>, <span class="st">"target_spectrum_id"</span>,</span>
<span>                                             <span class="st">"target_compound_name"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">mtches_df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    spectrum_id feature_id     score target_spectrum_id    target_compound_name</span></span>
<span><span class="co">## 1         sp_1      FT001        NA               &lt;NA&gt;                    &lt;NA&gt;</span></span>
<span><span class="co">## 2         sp_2      FT001 0.7869556           LU056604             Azaconazole</span></span>
<span><span class="co">## 3         sp_2      FT001 0.8855473           LU056603             Azaconazole</span></span>
<span><span class="co">## 4         sp_2      FT001 0.7234894           LU056602             Azaconazole</span></span>
<span><span class="co">## 5         sp_2      FT001 0.7219942           LU056605             Azaconazole</span></span>
<span><span class="co">## 6         sp_3      FT002        NA               &lt;NA&gt;                    &lt;NA&gt;</span></span>
<span><span class="co">## 7         sp_4      FT003 0.7769746           KW108103 triphenylphosphineoxide</span></span>
<span><span class="co">## 8         sp_4      FT003 0.7577286           KW108102 triphenylphosphineoxide</span></span>
<span><span class="co">## 9         sp_5      FT003        NA               &lt;NA&gt;                    &lt;NA&gt;</span></span>
<span><span class="co">## 10        sp_6      FT003 0.7433718           SM839501            Dimethachlor</span></span>
<span><span class="co">## 11        sp_6      FT003 0.7019807           EA070705            Dimethachlor</span></span>
<span><span class="co">## 12        sp_6      FT003 0.7081274           EA070711            Dimethachlor</span></span>
<span><span class="co">## 13        sp_7      FT004        NA               &lt;NA&gt;                    &lt;NA&gt;</span></span>
<span><span class="co">## 14        sp_8      FT004 0.7320465           SM839501            Dimethachlor</span></span>
<span><span class="co">## 15        sp_8      FT004 0.8106258           EA070705            Dimethachlor</span></span>
<span><span class="co">## 16        sp_8      FT004 0.7290458           EA070710            Dimethachlor</span></span>
<span><span class="co">## 17        sp_8      FT004 0.8168876           EA070711            Dimethachlor</span></span>
<span><span class="co">## 18        sp_8      FT004 0.7247800           EA070704            Dimethachlor</span></span>
<span><span class="co">## 19        sp_9      FT004 0.7412586           KW108103 triphenylphosphineoxide</span></span>
<span><span class="co">## 20        sp_9      FT004 0.7198787           KW108102 triphenylphosphineoxide</span></span>
<span><span class="co">## 21       sp_10      FT005        NA               &lt;NA&gt;                    &lt;NA&gt;</span></span>
<span><span class="co">## 22       sp_11      FT005        NA               &lt;NA&gt;                    &lt;NA&gt;</span></span>
<span><span class="co">## 23       sp_12      FT006        NA               &lt;NA&gt;                    &lt;NA&gt;</span></span>
<span><span class="co">## 24       sp_13      FT006        NA               &lt;NA&gt;                    &lt;NA&gt;</span></span></code></pre>
<p>Using the <code>plotSpectraMirror</code> function we can visualize
the matching results for one query spectrum. Note also that an
interactive, <code>shiny</code>-based, validation of matching results is
available with the <code>validateMatchedSpectra</code> function. Below
we call this function to show all matches for the second spectrum.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectra-plotting.html" class="external-link">plotSpectraMirror</a></span><span class="op">(</span><span class="va">mtches</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="MetaboAnnotation_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<p>Not unexpectedly, the peak intensities of query and target spectra
are on different scales. While this was no problem for the similarity
calculation (the normalized dot-product which is used by default is
independent of the absolute peak values) it is not ideal for
visualization. Thus, we apply below a simple scaling function to both
the query and target spectra and plot the spectra again afterwards (see
the help for <code>addProcessing</code> in the <code>Spectra</code>
package for more details on spectra data manipulations). This function
will replace the absolute spectra intensities with intensities relative
to the maximum intensity of each spectrum.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scale_int</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span><span class="op">[</span>, <span class="st">"intensity"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="st">"intensity"</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="st">"intensity"</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span><span class="va">mtches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">addProcessing</a></span><span class="op">(</span><span class="va">mtches</span>, <span class="va">scale_int</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectra-plotting.html" class="external-link">plotSpectraMirror</a></span><span class="op">(</span><span class="va">mtches</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="MetaboAnnotation_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<p>The query spectrum seems to nicely match the identified target
spectra. Below we extract the compound name of the target spectra for
this second query spectrum.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtches</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">$</span><span class="va">target_compound_name</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Azaconazole" "Azaconazole" "Azaconazole" "Azaconazole"</span></span></code></pre>
<p>As alternative to the <code>CompareSpectraParam</code> we could also
use the <code>MatchForwardReverseParam</code> with
<code>matchSpectra</code>. This has the same settings and performs the
same spectra similarity search than <code>CompareSpectraParam</code>,
but reports in addition (similar to MS-DIAL) to the (<em>forward</em>)
similarity score also the <em>reverse</em> spectra similarity score as
well as the <em>presence ratio</em> for matching spectra. While the
default <em>forward</em> score is calculated considering all peaks from
the query and the target spectrum (the peak mapping is performed using
an <em>outer join</em> strategy), the <em>reverse score</em> is
calculated only on peaks that are present in the target spectrum and the
matching peaks from the query spectrum (the peak mapping is performed
using a <em>right join</em> strategy). The <em>presence ratio</em> is
the ratio between the number of mapped peaks between the query and the
target spectrum and the total number of peaks in the target spectrum.
These values are available as spectra variables
<code>"reverse_score"</code> and <code>"presence_ratio"</code> in the
result object). Below we perform the same spectra matching as above, but
using the <code>MatchForwardReverseParam</code>.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompareSpectraParam.html">MatchForwardReverseParam</a></span><span class="op">(</span>requirePrecursor <span class="op">=</span> <span class="cn">TRUE</span>, ppm <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">mtches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchSpectra.html">matchSpectra</a></span><span class="op">(</span><span class="va">pest_ms2</span>, <span class="va">minimb</span>, param <span class="op">=</span> <span class="va">mp</span><span class="op">)</span></span>
<span><span class="va">mtches</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class MatchedSpectra </span></span>
<span><span class="co">## Total number of matches: 16 </span></span>
<span><span class="co">## Number of query objects: 13 (5 matched)</span></span>
<span><span class="co">## Number of target objects: 100 (11 matched)</span></span></code></pre>
<p>Below we extract the query and target spectra IDs, the compound name
and all scores.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">mtches</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spectrum_id"</span>, <span class="st">"target_spectrum_id"</span>,</span>
<span>                          <span class="st">"target_compound_name"</span>, <span class="st">"score"</span>, <span class="st">"reverse_score"</span>,</span>
<span>                          <span class="st">"presence_ratio"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    spectrum_id target_spectrum_id    target_compound_name     score</span></span>
<span><span class="co">## 1         sp_1               &lt;NA&gt;                    &lt;NA&gt;        NA</span></span>
<span><span class="co">## 2         sp_2           LU056604             Azaconazole 0.7869556</span></span>
<span><span class="co">## 3         sp_2           LU056603             Azaconazole 0.8855473</span></span>
<span><span class="co">## 4         sp_2           LU056602             Azaconazole 0.7234894</span></span>
<span><span class="co">## 5         sp_2           LU056605             Azaconazole 0.7219942</span></span>
<span><span class="co">## 6         sp_3               &lt;NA&gt;                    &lt;NA&gt;        NA</span></span>
<span><span class="co">## 7         sp_4           KW108103 triphenylphosphineoxide 0.7769746</span></span>
<span><span class="co">## 8         sp_4           KW108102 triphenylphosphineoxide 0.7577286</span></span>
<span><span class="co">## 9         sp_5               &lt;NA&gt;                    &lt;NA&gt;        NA</span></span>
<span><span class="co">## 10        sp_6           SM839501            Dimethachlor 0.7433718</span></span>
<span><span class="co">## 11        sp_6           EA070705            Dimethachlor 0.7019807</span></span>
<span><span class="co">## 12        sp_6           EA070711            Dimethachlor 0.7081274</span></span>
<span><span class="co">## 13        sp_7               &lt;NA&gt;                    &lt;NA&gt;        NA</span></span>
<span><span class="co">## 14        sp_8           SM839501            Dimethachlor 0.7320465</span></span>
<span><span class="co">## 15        sp_8           EA070705            Dimethachlor 0.8106258</span></span>
<span><span class="co">## 16        sp_8           EA070710            Dimethachlor 0.7290458</span></span>
<span><span class="co">## 17        sp_8           EA070711            Dimethachlor 0.8168876</span></span>
<span><span class="co">## 18        sp_8           EA070704            Dimethachlor 0.7247800</span></span>
<span><span class="co">## 19        sp_9           KW108103 triphenylphosphineoxide 0.7412586</span></span>
<span><span class="co">## 20        sp_9           KW108102 triphenylphosphineoxide 0.7198787</span></span>
<span><span class="co">## 21       sp_10               &lt;NA&gt;                    &lt;NA&gt;        NA</span></span>
<span><span class="co">## 22       sp_11               &lt;NA&gt;                    &lt;NA&gt;        NA</span></span>
<span><span class="co">## 23       sp_12               &lt;NA&gt;                    &lt;NA&gt;        NA</span></span>
<span><span class="co">## 24       sp_13               &lt;NA&gt;                    &lt;NA&gt;        NA</span></span>
<span><span class="co">##    reverse_score presence_ratio</span></span>
<span><span class="co">## 1             NA             NA</span></span>
<span><span class="co">## 2      0.8764394      0.5833333</span></span>
<span><span class="co">## 3      0.9239592      0.6250000</span></span>
<span><span class="co">## 4      0.7573541      0.6250000</span></span>
<span><span class="co">## 5      0.9519647      0.4285714</span></span>
<span><span class="co">## 6             NA             NA</span></span>
<span><span class="co">## 7      0.9025051      0.7500000</span></span>
<span><span class="co">## 8      0.9164348      0.5000000</span></span>
<span><span class="co">## 9             NA             NA</span></span>
<span><span class="co">## 10     0.8915201      0.5000000</span></span>
<span><span class="co">## 11     0.8687003      0.3333333</span></span>
<span><span class="co">## 12     0.8687472      0.3703704</span></span>
<span><span class="co">## 13            NA             NA</span></span>
<span><span class="co">## 14     0.8444402      0.5000000</span></span>
<span><span class="co">## 15     0.9267965      0.5000000</span></span>
<span><span class="co">## 16     0.8765496      0.7500000</span></span>
<span><span class="co">## 17     0.9236674      0.4814815</span></span>
<span><span class="co">## 18     0.8714208      0.8571429</span></span>
<span><span class="co">## 19     0.8743130      0.7500000</span></span>
<span><span class="co">## 20     0.8937751      0.5000000</span></span>
<span><span class="co">## 21            NA             NA</span></span>
<span><span class="co">## 22            NA             NA</span></span>
<span><span class="co">## 23            NA             NA</span></span>
<span><span class="co">## 24            NA             NA</span></span></code></pre>
<p>In these examples we matched query spectra only to target spectra if
their precursor m/z is ~ equal and reported only matches with a
similarity higher than 0.7. <code>CompareSpectraParam</code>, through
its parameter <code>THRESHFUN</code> would however also allow other
types of analyses. We could for example also report the <em>best
matching</em> target spectrum for each query spectrum, independently of
whether the similarity score is higher than a certain threshold. Below
we perform such an analysis defining a <code>THRESHFUN</code> that
selects always the best match.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">select_top_match</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">csp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompareSpectraParam.html">CompareSpectraParam</a></span><span class="op">(</span>ppm <span class="op">=</span> <span class="fl">10</span>, requirePrecursor <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                            THRESHFUN <span class="op">=</span> <span class="va">select_top_match</span><span class="op">)</span></span>
<span><span class="va">mtches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchSpectra.html">matchSpectra</a></span><span class="op">(</span><span class="va">pest_ms2</span>, <span class="va">minimb</span>, param <span class="op">=</span> <span class="va">csp2</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">mtches</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spectrum_id"</span>, <span class="st">"target_spectrum_id"</span>,</span>
<span>                                       <span class="st">"target_compound_name"</span>, <span class="st">"score"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    spectrum_id target_spectrum_id                   target_compound_name</span></span>
<span><span class="co">## 1         sp_1           SM839603                             Flufenacet</span></span>
<span><span class="co">## 2         sp_2           LU056603                            Azaconazole</span></span>
<span><span class="co">## 3         sp_3           SM839501                           Dimethachlor</span></span>
<span><span class="co">## 4         sp_4           KW108103                triphenylphosphineoxide</span></span>
<span><span class="co">## 5         sp_5           LU100202        2,2'-(Tetradecylimino)diethanol</span></span>
<span><span class="co">## 6         sp_6           SM839501                           Dimethachlor</span></span>
<span><span class="co">## 7         sp_7           RP005503              Glycoursodeoxycholic acid</span></span>
<span><span class="co">## 8         sp_8           EA070711                           Dimethachlor</span></span>
<span><span class="co">## 9         sp_9           KW108103                triphenylphosphineoxide</span></span>
<span><span class="co">## 10       sp_10           JP006901                  1-PHENYLETHYL ACETATE</span></span>
<span><span class="co">## 11       sp_11           EA070711                           Dimethachlor</span></span>
<span><span class="co">## 12       sp_12           EA070705                           Dimethachlor</span></span>
<span><span class="co">## 13       sp_13           LU101704 2-Ethylhexyl 4-(dimethylamino)benzoate</span></span>
<span><span class="co">##           score</span></span>
<span><span class="co">## 1  0.000000e+00</span></span>
<span><span class="co">## 2  8.855473e-01</span></span>
<span><span class="co">## 3  6.313687e-01</span></span>
<span><span class="co">## 4  7.769746e-01</span></span>
<span><span class="co">## 5  1.772117e-05</span></span>
<span><span class="co">## 6  7.433718e-01</span></span>
<span><span class="co">## 7  1.906998e-03</span></span>
<span><span class="co">## 8  8.168876e-01</span></span>
<span><span class="co">## 9  7.412586e-01</span></span>
<span><span class="co">## 10 4.085289e-04</span></span>
<span><span class="co">## 11 4.323403e-01</span></span>
<span><span class="co">## 12 3.469648e-03</span></span>
<span><span class="co">## 13 7.612480e-06</span></span></code></pre>
<p>Note that this whole example would work on any <code>Spectra</code>
object with MS2 spectra. Such objects could also be extracted from an
<code>xcms</code>-based LC-MS/MS data analysis with the
<code>chromPeaksSpectra</code> or <code>featureSpectra</code> functions
from the <em><a href="https://bioconductor.org/packages/3.17/xcms" class="external-link">xcms</a></em>
package. Also,</p>
<p>Matches can be also further validated using an interactive Shiny app
by calling <code>validateMatchedSpectra</code> on the
<code>MatchedSpectra</code> object. Individual matches can be set to
TRUE or FALSE in this app. By closing the app via the Save &amp; Close
button a filtered <code>MatchedSpectra</code> is returned, containing
only matches manually validated.</p>
<div class="section level4">
<h4 id="query-against-multiple-reference-databases">Query against multiple reference databases<a class="anchor" aria-label="anchor" href="#query-against-multiple-reference-databases"></a>
</h4>
<p>Getting access to reference spectra can sometimes be a little
cumbersome since it might involve lookup and download of specific
resources or eventual conversion of these into a format suitable for
import. <code>MetaboAnnotation</code> provides <em>compound annotation
sources</em> to simplify this process. These annotation source objects
represent references (links) to annotation resources and can be used in
the <code>matchSpectra</code> call to define the targed/reference
spectra. The annotation source object takes then care, upon request, of
retrieving the annotation data or connecting to the annotation
resources.</p>
<p>Also, <em>compound annotation sources</em> can be combined to allow
matching query spectra against multiple reference libraries in a single
call.</p>
<p>At present <code>MetaboAnnotation</code> supports the following types
of <em>compound annotation sources</em> (i.e. objects extending
<code>CompAnnotationSource</code>):</p>
<ul>
<li><p>Annotation resources that provide their data as a
<code>CompDb</code> database (defined by the <em><a href="https://bioconductor.org/packages/3.17/CompoundDb" class="external-link">CompoundDb</a></em>)
package. These are supported by the <code>CompDbSource</code>
class.</p></li>
<li><p>Annotation resources for which a dedicated <code>MsBackend</code>
backend is available hence supporting to access the data <em>via</em> a
<code>Spectra</code> object. These are supported by the
<code>SpectraDbSource</code> class.</p></li>
</ul>
<p>Various helper functions, specific for the annotation resource, are
available to create such annotation source objects:</p>
<ul>
<li><p><code>CompDbSource</code>: creates a compound annotation source
object from the provided <code>CompDb</code> SQLite data base file. This
function can be used to integrate an existing (locally available)
<code>CompDb</code> annotation database into an annotation
workflow.</p></li>
<li><p><code>MassBankSource</code>: creates a annotation source object
for a specific MassBank release. The desired release can be specified
with the <code>release</code> parameter
(e.g. <code>release = "2021.03"</code> or
<code>release = "2022.06"</code>). The function will then download the
respective annotation database from Bioconductor’s <em><a href="https://bioconductor.org/packages/3.17/AnnotationHub" class="external-link">AnnotationHub</a></em>.</p></li>
</ul>
<p>In the example below we create a annotation source for MassBank
release <em>2022.06</em>. This call will lookup the requested version in
Biocondutor’s (online) <code>AnnotationHub</code> and download the data.
Subsequent requests for the same annotation resource will load the
locally cached version instead. Upcoming MassBank database releases will
be added to <code>AnnotationHub</code> after their official release and
all previous releases will be available as well.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mbank</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CompDbSource.html">MassBankSource</a></span><span class="op">(</span><span class="st">"2022.06"</span><span class="op">)</span></span>
<span><span class="va">mbank</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class CompDbSource </span></span>
<span><span class="co">## Metadata information:</span></span>
<span><span class="co">##   - source: MassBank</span></span>
<span><span class="co">##   - url: https://massbank.eu/MassBank/</span></span>
<span><span class="co">##   - source_version: 2022.06</span></span>
<span><span class="co">##   - source_date: 2022-06-21</span></span>
<span><span class="co">##   - organism: NA</span></span>
<span><span class="co">##   - db_creation_date: Tue Aug 30 06:51:39 2022</span></span>
<span><span class="co">##   - supporting_package: CompoundDb</span></span>
<span><span class="co">##   - supporting_object: CompDb</span></span></code></pre>
<p>We can now use that annotation source object in the
<code>matchSpectra</code> call to compare the experimental spectra from
the previous examples against that release of MassBank.</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchSpectra.html">matchSpectra</a></span><span class="op">(</span></span>
<span>    <span class="va">pest_ms2</span>, <span class="va">mbank</span>,</span>
<span>    param <span class="op">=</span> <span class="fu"><a href="../reference/CompareSpectraParam.html">CompareSpectraParam</a></span><span class="op">(</span>requirePrecursor <span class="op">=</span> <span class="cn">TRUE</span>, ppm <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'MsBackendCompDb' does not support parallel processing. Switching to serial processing.</span></span>
<span><span class="co">## 'MsBackendCompDb' does not support parallel processing. Switching to serial processing.</span></span>
<span><span class="co">## 'MsBackendCompDb' does not support parallel processing. Switching to serial processing.</span></span>
<span><span class="co">## 'MsBackendCompDb' does not support parallel processing. Switching to serial processing.</span></span>
<span><span class="co">## 'MsBackendCompDb' does not support parallel processing. Switching to serial processing.</span></span>
<span><span class="co">## 'MsBackendCompDb' does not support parallel processing. Switching to serial processing.</span></span>
<span><span class="co">## 'MsBackendCompDb' does not support parallel processing. Switching to serial processing.</span></span>
<span><span class="co">## 'MsBackendCompDb' does not support parallel processing. Switching to serial processing.</span></span>
<span><span class="co">## 'MsBackendCompDb' does not support parallel processing. Switching to serial processing.</span></span>
<span><span class="co">## 'MsBackendCompDb' does not support parallel processing. Switching to serial processing.</span></span>
<span><span class="co">## 'MsBackendCompDb' does not support parallel processing. Switching to serial processing.</span></span></code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class MatchedSpectra </span></span>
<span><span class="co">## Total number of matches: 14 </span></span>
<span><span class="co">## Number of query objects: 13 (6 matched)</span></span>
<span><span class="co">## Number of target objects: 10 (10 matched)</span></span></code></pre>
<p>The result object contains only the matching fragment spectra from
the reference database.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Matched.html">target</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## MSn data (Spectra) with 10 spectra in a MsBackendDataFrame backend:</span></span>
<span><span class="co">##      msLevel     rtime scanIndex</span></span>
<span><span class="co">##    &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1          2        NA        NA</span></span>
<span><span class="co">## 2          2        NA        NA</span></span>
<span><span class="co">## 3          2        NA        NA</span></span>
<span><span class="co">## 4          2        NA        NA</span></span>
<span><span class="co">## 5          2        NA        NA</span></span>
<span><span class="co">## 6          2        NA        NA</span></span>
<span><span class="co">## 7          2        NA        NA</span></span>
<span><span class="co">## 8          2        NA        NA</span></span>
<span><span class="co">## 9          2        NA        NA</span></span>
<span><span class="co">## 10         2        NA        NA</span></span>
<span><span class="co">##  ... 46 more variables/columns.</span></span>
<span><span class="co">## Processing:</span></span>
<span><span class="co">##  Switch backend from MsBackendCompDb to MsBackendDataFrame [Wed Apr 12 11:36:05 2023]</span></span></code></pre>
<p>And the names of the compounds with matching fragment spectra.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Matched.html">matchedData</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">$</span><span class="va">target_name</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] NA                         "Azaconazole"             </span></span>
<span><span class="co">##  [3] "Azaconazole"              "Azaconazole"             </span></span>
<span><span class="co">##  [5] "Azaconazole"              NA                        </span></span>
<span><span class="co">##  [7] "triphenylphosphineoxide"  "triphenylphosphineoxide" </span></span>
<span><span class="co">##  [9] "Triphenylphosphine oxide" "N,N-Dimethyldodecylamine"</span></span>
<span><span class="co">## [11] "Dimethachlor"             NA                        </span></span>
<span><span class="co">## [13] "Dimethachlor"             "Triphenylphosphine oxide"</span></span>
<span><span class="co">## [15] "triphenylphosphineoxide"  "triphenylphosphineoxide" </span></span>
<span><span class="co">## [17] "Triphenylphosphine oxide" NA                        </span></span>
<span><span class="co">## [19] NA                         NA                        </span></span>
<span><span class="co">## [21] NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="performance-and-parallel-processing">Performance and parallel processing<a class="anchor" aria-label="anchor" href="#performance-and-parallel-processing"></a>
</h4>
<p>Pre-filtering the target spectra based on similar precursor m/z
(using <code>requirePrecursor = TRUE</code> generally speeds up the call
because a spectra comparison needs only to be performed on subsets of
target spectra. Performance of the <code>matchSpectra</code> function
depends however also on the backend used for the query and target
<code>Spectra</code>. For some backends the peaks data (i.e. m/z and
intensity values) might not be already loaded into memory and hence
spectra comparisons might be slower because that data needs to be first
loaded. As an example, for <code>Spectra</code> objects, such as our
<code>pest_ms2</code> variable, that use the
<code>MsBackendMzR</code>backend, the peaks data needs to be loaded from
the raw data files before the spectra similarity scores can be
calculated. Changing the backend to an in-memory data representation
before <code>matchSpectra</code> can thus improve the performance (at
the cost of a higher memory demand).</p>
<p>Below we change the backends of the <code>pest_ms2</code> and
<code>minimb</code> objects to <code>MsBackendMemory</code> which keeps
all data (spectra and peaks data) in memory and we compare the
performance against the originally used <code>MsBackendMzR</code> (for
<code>pest_ms2</code>) and <code>MsBackendDataFrame</code> (for
<code>minimb</code>).</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pest_ms2_mem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/hidden_aliases.html" class="external-link">setBackend</a></span><span class="op">(</span><span class="va">pest_ms2</span>, <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/MsBackend.html" class="external-link">MsBackendMemory</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">minimb_mem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/hidden_aliases.html" class="external-link">setBackend</a></span><span class="op">(</span><span class="va">minimb</span>, <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/MsBackend.html" class="external-link">MsBackendMemory</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compareSpectra</a></span><span class="op">(</span><span class="va">pest_ms2</span>, <span class="va">minimb</span>, param <span class="op">=</span> <span class="va">csp</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">compareSpectra</a></span><span class="op">(</span><span class="va">pest_ms2_mem</span>, <span class="va">minimb_mem</span>, param <span class="op">=</span> <span class="va">csp</span><span class="op">)</span>,</span>
<span>               times <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Unit: milliseconds</span></span>
<span><span class="co">##                                                   expr     min      lq     mean</span></span>
<span><span class="co">##          compareSpectra(pest_ms2, minimb, param = csp) 62.1399 62.3952 62.95416</span></span>
<span><span class="co">##  compareSpectra(pest_ms2_mem, minimb_mem, param = csp) 35.3846 35.6297 44.93432</span></span>
<span><span class="co">##   median      uq     max neval</span></span>
<span><span class="co">##  62.8599 63.1160 64.2598     5</span></span>
<span><span class="co">##  35.7606 50.8832 67.0135     5</span></span></code></pre>
<p>There is a considerable performance gain by using the
<code>MsBackendMemory</code> over the two other backends, that comes
however at the cost of a higher memory demand. Thus, for large data sets
(or reference libraries) this might not be an option. See also <a href="https://github.com/rformassspectrometry/MetaboAnnotation/issues/93" class="external-link">issue
#93</a> in the <code>MetaboAnnotation</code> github repository for more
benchmarks and information on performance of
<code>matchSpectra</code>.</p>
<p>If for <code>target</code> a <code>Spectra</code> using a SQL
database-based backend is used (such as a
<code>MsBackendMassbankSql</code>, <code>MsBackendCompDb</code> or
<code>MsBackendSql</code>) and spectra matching is performed with
<code>requirePrecursorMz = TRUE</code>, simply <em>caching</em> the
precursor m/z values of all target spectra in memory improves the
performance of <code>matchSpectra</code> considerably. This can be
easily done with e.g.
<code>target_sps$precursorMz &lt;- precursorMz(target_sps)</code> where
<code>target_sps</code> is the <code>Spectra</code> object that uses one
of the above mentioned backends. With this call all precursor m/z values
will be cached within <code>target_sps</code> and any
<code>precursorMz(target_sps)</code> call (which is used by
<code>matchSpectra</code> to select the candidate spectra against which
to compare a query spectrum) will not require a separate SQL call.</p>
<p>Parallel processing can also improve performance, but might not be
possible for all backends. In particular, backends based on SQL
databases don’t allow parallel processing because the database
connection can not be shared across different processes.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<pre><code><span><span class="co">## R version 4.3.0 beta (2023-04-06 r84184)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.2 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] microbenchmark_1.4.9        msdata_0.39.0              </span></span>
<span><span class="co">##  [3] QFeatures_1.9.3             MultiAssayExperiment_1.25.9</span></span>
<span><span class="co">##  [5] SummarizedExperiment_1.29.1 Biobase_2.59.0             </span></span>
<span><span class="co">##  [7] GenomicRanges_1.51.4        GenomeInfoDb_1.35.16       </span></span>
<span><span class="co">##  [9] IRanges_2.33.1              MatrixGenerics_1.11.1      </span></span>
<span><span class="co">## [11] matrixStats_0.63.0-9003     Spectra_1.9.15             </span></span>
<span><span class="co">## [13] ProtGenerics_1.31.0         BiocParallel_1.33.12       </span></span>
<span><span class="co">## [15] S4Vectors_0.37.5            MetaboAnnotation_1.3.2     </span></span>
<span><span class="co">## [17] AnnotationHub_3.7.4         BiocFileCache_2.7.2        </span></span>
<span><span class="co">## [19] dbplyr_2.3.2                BiocGenerics_0.45.3        </span></span>
<span><span class="co">## [21] BiocStyle_2.27.1           </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] DBI_1.1.3                     bitops_1.0-7                 </span></span>
<span><span class="co">##   [3] gridExtra_2.3                 rlang_1.1.0                  </span></span>
<span><span class="co">##   [5] magrittr_2.0.3                clue_0.3-64                  </span></span>
<span><span class="co">##   [7] compiler_4.3.0                RSQLite_2.3.1                </span></span>
<span><span class="co">##   [9] png_0.1-8                     systemfonts_1.0.4            </span></span>
<span><span class="co">##  [11] vctrs_0.6.1                   stringr_1.5.0                </span></span>
<span><span class="co">##  [13] pkgconfig_2.0.3               MetaboCoreUtils_1.7.0        </span></span>
<span><span class="co">##  [15] crayon_1.5.2                  fastmap_1.1.1                </span></span>
<span><span class="co">##  [17] XVector_0.39.0                ellipsis_0.3.2               </span></span>
<span><span class="co">##  [19] utf8_1.2.3                    promises_1.2.0.1             </span></span>
<span><span class="co">##  [21] rmarkdown_2.21                ragg_1.2.5                   </span></span>
<span><span class="co">##  [23] purrr_1.0.1                   bit_4.0.5                    </span></span>
<span><span class="co">##  [25] xfun_0.38                     zlibbioc_1.45.0              </span></span>
<span><span class="co">##  [27] cachem_1.0.7                  ChemmineR_3.51.1             </span></span>
<span><span class="co">##  [29] jsonlite_1.8.4                blob_1.2.4                   </span></span>
<span><span class="co">##  [31] highr_0.10                    later_1.3.0                  </span></span>
<span><span class="co">##  [33] DelayedArray_0.25.0           interactiveDisplayBase_1.37.0</span></span>
<span><span class="co">##  [35] cluster_2.1.4                 parallel_4.3.0               </span></span>
<span><span class="co">##  [37] R6_2.5.1                      bslib_0.4.2                  </span></span>
<span><span class="co">##  [39] stringi_1.7.12                jquerylib_0.1.4              </span></span>
<span><span class="co">##  [41] Rcpp_1.0.10                   bookdown_0.33                </span></span>
<span><span class="co">##  [43] knitr_1.42                    base64enc_0.1-3              </span></span>
<span><span class="co">##  [45] igraph_1.4.2                  Matrix_1.5-4                 </span></span>
<span><span class="co">##  [47] httpuv_1.6.9                  tidyselect_1.2.0             </span></span>
<span><span class="co">##  [49] yaml_2.3.7                    codetools_0.2-19             </span></span>
<span><span class="co">##  [51] curl_5.0.0                    lattice_0.21-8               </span></span>
<span><span class="co">##  [53] tibble_3.2.1                  withr_2.5.0                  </span></span>
<span><span class="co">##  [55] shiny_1.7.4                   KEGGREST_1.39.0              </span></span>
<span><span class="co">##  [57] evaluate_0.20                 desc_1.4.2                   </span></span>
<span><span class="co">##  [59] xml2_1.3.3                    Biostrings_2.67.2            </span></span>
<span><span class="co">##  [61] pillar_1.9.0                  BiocManager_1.30.20          </span></span>
<span><span class="co">##  [63] filelock_1.0.2                DT_0.27                      </span></span>
<span><span class="co">##  [65] ncdf4_1.21                    generics_0.1.3               </span></span>
<span><span class="co">##  [67] rprojroot_2.0.3               RCurl_1.98-1.12              </span></span>
<span><span class="co">##  [69] BiocVersion_3.17.1            ggplot2_3.4.2                </span></span>
<span><span class="co">##  [71] munsell_0.5.0                 scales_1.2.1                 </span></span>
<span><span class="co">##  [73] xtable_1.8-4                  glue_1.6.2                   </span></span>
<span><span class="co">##  [75] lazyeval_0.2.2                tools_4.3.0                  </span></span>
<span><span class="co">##  [77] mzR_2.33.1                    fs_1.6.1                     </span></span>
<span><span class="co">##  [79] grid_4.3.0                    MsCoreUtils_1.11.5           </span></span>
<span><span class="co">##  [81] AnnotationDbi_1.61.2          colorspace_2.1-0             </span></span>
<span><span class="co">##  [83] GenomeInfoDbData_1.2.10       cli_3.6.1                    </span></span>
<span><span class="co">##  [85] rappdirs_0.3.3                textshaping_0.3.6            </span></span>
<span><span class="co">##  [87] rsvg_2.4.0                    fansi_1.0.4                  </span></span>
<span><span class="co">##  [89] dplyr_1.1.1                   AnnotationFilter_1.23.0      </span></span>
<span><span class="co">##  [91] gtable_0.3.3                  sass_0.4.5                   </span></span>
<span><span class="co">##  [93] digest_0.6.31                 rjson_0.2.21                 </span></span>
<span><span class="co">##  [95] htmlwidgets_1.6.2             memoise_2.0.1                </span></span>
<span><span class="co">##  [97] htmltools_0.5.5               pkgdown_2.0.7.9000           </span></span>
<span><span class="co">##  [99] lifecycle_1.0.3               httr_1.4.5                   </span></span>
<span><span class="co">## [101] CompoundDb_1.3.3              mime_0.12                    </span></span>
<span><span class="co">## [103] bit64_4.0.5                   MASS_7.3-58.4</span></span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-rainer_modular_2022" class="csl-entry">
Rainer, Johannes, Andrea Vicini, Liesa Salzer, Jan Stanstrup, Josep M.
Badia, Steffen Neumann, Michael A. Stravs, et al. 2022. <span>“A
<span>Modular</span> and <span>Expandable</span> <span>Ecosystem</span>
for <span>Metabolomics</span> <span>Data</span> <span>Annotation</span>
in <span>R</span>.”</span> <em>Metabolites</em> 12 (2): 173. <a href="https://doi.org/10.3390/metabo12020173" class="external-link">https://doi.org/10.3390/metabo12020173</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Witting, Johannes Rainer, Andrea Vicini, Carolin Huber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
