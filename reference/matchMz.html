<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='The matchMz method matches elements from query with those in target
using different matching approaches depending on parameter param.
Generally, query is expected to contain MS experimental values
(m/z and possibly retention time) while target theoretical values from
reference compounds. target can be numeric or data.frameOrSimilar
(i.e. data.frame, matrix or DataFrame). The same is true for query
which in addition can also be SummarizedExperiment.
Available param objects and corresponding matching approaches are:
Mass2MzParam: match m/z values against reference compounds for
which the (exact) mass is known. Before matching, m/z values are calculated
from the compounds masses in the target table using the adducts
specified via Mass2MzParam adducts parameter (defaults to
adducts = "[M+H]+"). query must be a data.frameOrSimilar with a
column containing m/z values (column name can be specified with parameter
mzColname which defaults to "mz") or a numeric with the m/z values of
the features. target must be a data.frameOrSimilar with a column
containing (monoisotopic) masses of the reference compounds (the column
name can be specified with parameter massColname which defaults
to "exactmass") or a numeric with the mass values.
Parameters tolerance and ppm allow to define the maximal acceptable
(constant or m/z relative) difference between m/zs in query and those
obtained from masses in target.
Mass2MzRtParam: match m/z and retention time values against
reference compounds for which the (exact) mass and retention time are
known. Before matching, m/z values are calculated from the compounds masses
in the target table using the adducts specified via
Mass2MzParam adducts parameter (defaults to adducts = "[M+H]+").
The retention time is considered equal for different adducts of the
same compound. query must be a data.frameOrSimilar with m/z and
retention time values of the features. The names of the columns containing
these information can be specified with parameters mzColname and
rtColname which default to "mz" and "rt", respectively.
target must be a data.frameOrSimilar with the (monoisotopic)
masses and retention times for each reference compound. The names of the
columns containing this information can be specified with parameters
massColname and rtColname which default to "exactmass" and "rt",
respectively. Mass2MzRtParam parameters tolerance and ppm have
the same meaning as in Mass2MzParam; parameter toleranceRt allows to
specify the maximal acceptable difference between query and target
retention time values.
MzParam: match m/z values against reference compounds for which the m/z
is known. query must be either a data.frameOrSimilar with a column
containing m/z values (whose name can be specified with parameter
mzColname, default being mzColname = "mz") or a numeric with the m/z
values of the features. The same holds for target. MzParam parameters
tolerance and ppm allow to define the maximal acceptable (constant or
m/z relative) difference between query and target m/z values.
MzRtParam: match m/z and retention time values against reference
compounds for which m/z and retention time are known. query must be a
data.frameOrSimilar or a SummarizedExperiment query in the first
case or its rowData in the second must have columns containing the m/zs
and retention times of the features. target must be a
data.frameOrSimilar again with columns containing m/zs and retention
times. The names of such columns can be specified with parameters
mzColname and rtColname (defaulting to c("mz", "mz") and
c("rt", "rt"), respectively). MzRtParam parameters tolerance and
ppm have the same meaning as in MzParam; MzRtParam parameter
toleranceRt allows to specify the maximal acceptable difference between
query and target retention time values.
Mz2MassParam: first convert to masses the m/z values of query and
target based respectively on Mz2MassParam parameters queryAdducts
(defaults to queryAdducts = "[M+H]+") and targetAdducts (defaults to
targetAdducts = "[M-H]-") and then match the obtained masses.
query must be either a data.frameOrSimilar with a column containing
m/z values (whose name can be specified with parameter mzColname,
default being mzColname = "mz") or a numeric with the m/z values.
The same holds for target. Parameters tolerance and ppm allow to
define the maximal acceptable (constant or mass relative) difference
between masses derived from query and target.
Mz2MassRtParam: first convert to masses the m/z values of query and
target based respectively on Mz2MassRtParam parameters queryAdducts
(defaults to queryAdducts = "[M+H]+") and targetAdducts (defaults to
targetAdducts = "[M-H]-") and then match the obtained masses and
corresponding retention times (to each mass value corresponds the same
retention time associated to the m/z from which the mass value was
obtained). query must be a data.frameOrSimilar with a column containing
m/z values (whose name can be specified with parameter mzColname,
default being mzColname = "mz"). The same holds for target.
Parameters tolerance and ppm have the same meaning as in
Mz2MassParam. Parameter toleranceRt allows to specify the maximal
acceptable difference between retention time values.
ValueParam: matches elements from from query (if numeric) or else
from one of its columns with those from target (if numeric) or else
from one of its columns. The name(s) of the colum(s) used for the matching
(if query and target are not bot numeric has/have to be specified via
parameter valueColname.

'><title>m/z matching — ValueParam • MetaboAnnotation</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="m/z matching — ValueParam"><meta property="og:description" content='The matchMz method matches elements from query with those in target
using different matching approaches depending on parameter param.
Generally, query is expected to contain MS experimental values
(m/z and possibly retention time) while target theoretical values from
reference compounds. target can be numeric or data.frameOrSimilar
(i.e. data.frame, matrix or DataFrame). The same is true for query
which in addition can also be SummarizedExperiment.
Available param objects and corresponding matching approaches are:
Mass2MzParam: match m/z values against reference compounds for
which the (exact) mass is known. Before matching, m/z values are calculated
from the compounds masses in the target table using the adducts
specified via Mass2MzParam adducts parameter (defaults to
adducts = "[M+H]+"). query must be a data.frameOrSimilar with a
column containing m/z values (column name can be specified with parameter
mzColname which defaults to "mz") or a numeric with the m/z values of
the features. target must be a data.frameOrSimilar with a column
containing (monoisotopic) masses of the reference compounds (the column
name can be specified with parameter massColname which defaults
to "exactmass") or a numeric with the mass values.
Parameters tolerance and ppm allow to define the maximal acceptable
(constant or m/z relative) difference between m/zs in query and those
obtained from masses in target.
Mass2MzRtParam: match m/z and retention time values against
reference compounds for which the (exact) mass and retention time are
known. Before matching, m/z values are calculated from the compounds masses
in the target table using the adducts specified via
Mass2MzParam adducts parameter (defaults to adducts = "[M+H]+").
The retention time is considered equal for different adducts of the
same compound. query must be a data.frameOrSimilar with m/z and
retention time values of the features. The names of the columns containing
these information can be specified with parameters mzColname and
rtColname which default to "mz" and "rt", respectively.
target must be a data.frameOrSimilar with the (monoisotopic)
masses and retention times for each reference compound. The names of the
columns containing this information can be specified with parameters
massColname and rtColname which default to "exactmass" and "rt",
respectively. Mass2MzRtParam parameters tolerance and ppm have
the same meaning as in Mass2MzParam; parameter toleranceRt allows to
specify the maximal acceptable difference between query and target
retention time values.
MzParam: match m/z values against reference compounds for which the m/z
is known. query must be either a data.frameOrSimilar with a column
containing m/z values (whose name can be specified with parameter
mzColname, default being mzColname = "mz") or a numeric with the m/z
values of the features. The same holds for target. MzParam parameters
tolerance and ppm allow to define the maximal acceptable (constant or
m/z relative) difference between query and target m/z values.
MzRtParam: match m/z and retention time values against reference
compounds for which m/z and retention time are known. query must be a
data.frameOrSimilar or a SummarizedExperiment query in the first
case or its rowData in the second must have columns containing the m/zs
and retention times of the features. target must be a
data.frameOrSimilar again with columns containing m/zs and retention
times. The names of such columns can be specified with parameters
mzColname and rtColname (defaulting to c("mz", "mz") and
c("rt", "rt"), respectively). MzRtParam parameters tolerance and
ppm have the same meaning as in MzParam; MzRtParam parameter
toleranceRt allows to specify the maximal acceptable difference between
query and target retention time values.
Mz2MassParam: first convert to masses the m/z values of query and
target based respectively on Mz2MassParam parameters queryAdducts
(defaults to queryAdducts = "[M+H]+") and targetAdducts (defaults to
targetAdducts = "[M-H]-") and then match the obtained masses.
query must be either a data.frameOrSimilar with a column containing
m/z values (whose name can be specified with parameter mzColname,
default being mzColname = "mz") or a numeric with the m/z values.
The same holds for target. Parameters tolerance and ppm allow to
define the maximal acceptable (constant or mass relative) difference
between masses derived from query and target.
Mz2MassRtParam: first convert to masses the m/z values of query and
target based respectively on Mz2MassRtParam parameters queryAdducts
(defaults to queryAdducts = "[M+H]+") and targetAdducts (defaults to
targetAdducts = "[M-H]-") and then match the obtained masses and
corresponding retention times (to each mass value corresponds the same
retention time associated to the m/z from which the mass value was
obtained). query must be a data.frameOrSimilar with a column containing
m/z values (whose name can be specified with parameter mzColname,
default being mzColname = "mz"). The same holds for target.
Parameters tolerance and ppm have the same meaning as in
Mz2MassParam. Parameter toleranceRt allows to specify the maximal
acceptable difference between retention time values.
ValueParam: matches elements from from query (if numeric) or else
from one of its columns with those from target (if numeric) or else
from one of its columns. The name(s) of the colum(s) used for the matching
(if query and target are not bot numeric has/have to be specified via
parameter valueColname.

'><meta property="og:image" content="https://rformassspectrometry.github.io/MetaboAnnotation/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MetaboAnnotation</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.10</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/MetaboAnnotation.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/MetaboAnnotation/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>m/z matching</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/MetaboAnnotation/blob/HEAD/R/matchMz.R" class="external-link"><code>R/matchMz.R</code></a></small>
      <div class="d-none name"><code>matchMz.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>matchMz</code> method matches elements from <code>query</code> with those in <code>target</code>
using different matching approaches depending on parameter <code>param</code>.
Generally, <code>query</code> is expected to contain MS experimental values
(m/z and possibly retention time) while <code>target</code> theoretical values from
reference compounds. <code>target</code> can be <code>numeric</code> or <code>data.frameOrSimilar</code>
(i.e. <code>data.frame</code>, <code>matrix</code> or <code>DataFrame</code>). The same is true for <code>query</code>
which in addition can also be <code>SummarizedExperiment</code>.</p>
<p>Available <code>param</code> objects and corresponding matching approaches are:</p><ul><li><p><code>Mass2MzParam</code>: match m/z values against reference compounds for
which the (exact) mass is known. Before matching, m/z values are calculated
from the compounds masses in the <em>target</em> table using the adducts
specified via <code>Mass2MzParam</code> <code>adducts</code> parameter (defaults to
<code>adducts = "[M+H]+"</code>). <code>query</code> must be a <code>data.frameOrSimilar</code> with a
column containing m/z values (column name can be specified with parameter
<code>mzColname</code> which defaults to <code>"mz"</code>) or a <code>numeric</code> with the m/z values of
the features. <code>target</code> must be a <code>data.frameOrSimilar</code> with a column
containing (monoisotopic) masses of the reference compounds (the column
name can be specified with parameter <code>massColname</code> which defaults
to <code>"exactmass"</code>) or a <code>numeric</code> with the mass values.
Parameters <code>tolerance</code> and <code>ppm</code> allow to define the maximal acceptable
(constant or m/z relative) difference between m/zs in <code>query</code> and those
obtained from masses in <code>target</code>.</p></li>
<li><p><code>Mass2MzRtParam</code>: match m/z and retention time values against
reference compounds for which the (exact) mass <strong>and</strong> retention time are
known. Before matching, m/z values are calculated from the compounds masses
in the <em>target</em> table using the adducts specified via
<code>Mass2MzParam</code> <code>adducts</code> parameter (defaults to <code>adducts = "[M+H]+"</code>).
The retention time is considered equal for different adducts of the
same compound. <code>query</code> must be a <code>data.frameOrSimilar</code> with m/z and
retention time values of the features. The names of the columns containing
these information can be specified with parameters <code>mzColname</code> and
<code>rtColname</code> which default to <code>"mz"</code> and <code>"rt"</code>, respectively.
<code>target</code> must be a <code>data.frameOrSimilar</code> with the (monoisotopic)
masses and retention times for each reference compound. The names of the
columns containing this information can be specified with parameters
<code>massColname</code> and <code>rtColname</code> which default to <code>"exactmass"</code> and <code>"rt"</code>,
respectively. <code>Mass2MzRtParam</code> parameters <code>tolerance</code> and <code>ppm</code> have
the same meaning as in <code>Mass2MzParam</code>; parameter <code>toleranceRt</code> allows to
specify the maximal acceptable difference between query and target
retention time values.</p></li>
<li><p><code>MzParam</code>: match m/z values against reference compounds for which the m/z
is known. <code>query</code> must be either a <code>data.frameOrSimilar</code> with a column
containing m/z values (whose name can be specified with parameter
<code>mzColname</code>, default being <code>mzColname = "mz"</code>) or a <code>numeric</code> with the m/z
values of the features. The same holds for <code>target</code>. <code>MzParam</code> parameters
<code>tolerance</code> and <code>ppm</code> allow to define the maximal acceptable (constant or
m/z relative) difference between query and target m/z values.</p></li>
<li><p><code>MzRtParam</code>: match m/z and retention time values against reference
compounds for which m/z and retention time are known. <code>query</code> must be a
<code>data.frameOrSimilar</code> or a <code>SummarizedExperiment</code> <code>query</code> in the first
case or its <code>rowData</code> in the second must have columns containing the m/zs
and retention times of the features. <code>target</code> must be a
<code>data.frameOrSimilar</code> again with columns containing m/zs and retention
times. The names of such columns can be specified with parameters
<code>mzColname</code> and <code>rtColname</code> (defaulting to <code>c("mz", "mz")</code> and
<code>c("rt", "rt")</code>, respectively). <code>MzRtParam</code> parameters <code>tolerance</code> and
<code>ppm</code> have the same meaning as in <code>MzParam</code>; <code>MzRtParam</code> parameter
<code>toleranceRt</code> allows to specify the maximal acceptable difference between
query and target retention time values.</p></li>
<li><p><code>Mz2MassParam</code>: first convert to masses the m/z values of <code>query</code> and
<code>target</code> based respectively on <code>Mz2MassParam</code> parameters <code>queryAdducts</code>
(defaults to <code>queryAdducts = "[M+H]+"</code>) and <code>targetAdducts</code> (defaults to
<code>targetAdducts = "[M-H]-"</code>) and then match the obtained masses.
<code>query</code> must be either a <code>data.frameOrSimilar</code> with a column containing
m/z values (whose name can be specified with parameter <code>mzColname</code>,
default being <code>mzColname = "mz"</code>) or a <code>numeric</code> with the m/z values.
The same holds for <code>target</code>. Parameters <code>tolerance</code> and <code>ppm</code> allow to
define the maximal acceptable (constant or mass relative) difference
between masses derived from <code>query</code> and <code>target</code>.</p></li>
<li><p><code>Mz2MassRtParam</code>: first convert to masses the m/z values of <code>query</code> and
<code>target</code> based respectively on <code>Mz2MassRtParam</code> parameters <code>queryAdducts</code>
(defaults to <code>queryAdducts = "[M+H]+"</code>) and <code>targetAdducts</code> (defaults to
<code>targetAdducts = "[M-H]-"</code>) and then match the obtained masses and
corresponding retention times (to each mass value corresponds the same
retention time associated to the m/z from which the mass value was
obtained). <code>query</code> must be a <code>data.frameOrSimilar</code> with a column containing
m/z values (whose name can be specified with parameter <code>mzColname</code>,
default being <code>mzColname = "mz"</code>). The same holds for <code>target</code>.
Parameters <code>tolerance</code> and <code>ppm</code> have the same meaning as in
<code>Mz2MassParam</code>. Parameter <code>toleranceRt</code> allows to specify the maximal
acceptable difference between retention time values.</p></li>
<li><p><code>ValueParam</code>: matches elements from from <code>query</code> (if <code>numeric</code>) or else
from one of its columns with those from <code>target</code> (if <code>numeric</code>) or else
from one of its columns. The name(s) of the colum(s) used for the matching
(if <code>query</code> and <code>target</code> are not bot numeric has/have to be specified via
parameter <code>valueColname</code>.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">ValueParam</span><span class="op">(</span>tolerance <span class="op">=</span> <span class="fl">0</span>, ppm <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="fu">MzParam</span><span class="op">(</span>tolerance <span class="op">=</span> <span class="fl">0</span>, ppm <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="fu">Mass2MzParam</span><span class="op">(</span>adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span><span class="op">)</span>, tolerance <span class="op">=</span> <span class="fl">0</span>, ppm <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="fu">Mass2MzRtParam</span><span class="op">(</span>adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span><span class="op">)</span>, tolerance <span class="op">=</span> <span class="fl">0</span>, ppm <span class="op">=</span> <span class="fl">5</span>, toleranceRt <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="fu">MzRtParam</span><span class="op">(</span>tolerance <span class="op">=</span> <span class="fl">0</span>, ppm <span class="op">=</span> <span class="fl">0</span>, toleranceRt <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="fu">Mz2MassParam</span><span class="op">(</span>
  queryAdducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span><span class="op">)</span>,
  targetAdducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M-H]-"</span><span class="op">)</span>,
  tolerance <span class="op">=</span> <span class="fl">0</span>,
  ppm <span class="op">=</span> <span class="fl">5</span>
<span class="op">)</span>

<span class="fu">Mz2MassRtParam</span><span class="op">(</span>
  queryAdducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span><span class="op">)</span>,
  targetAdducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span><span class="op">)</span>,
  tolerance <span class="op">=</span> <span class="fl">0</span>,
  ppm <span class="op">=</span> <span class="fl">5</span>,
  toleranceRt <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span>

<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S4 method for numeric,numeric,ValueParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span><span class="op">)</span>

<span class="co"># S4 method for numeric,data.frameOrSimilar,ValueParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, valueColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># S4 method for data.frameOrSimilar,numeric,ValueParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, valueColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># S4 method for data.frameOrSimilar,data.frameOrSimilar,ValueParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, valueColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># S4 method for numeric,numeric,Mass2MzParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span><span class="op">)</span>

<span class="co"># S4 method for numeric,data.frameOrSimilar,Mass2MzParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, massColname <span class="op">=</span> <span class="st">"exactmass"</span><span class="op">)</span>

<span class="co"># S4 method for data.frameOrSimilar,numeric,Mass2MzParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, mzColname <span class="op">=</span> <span class="st">"mz"</span><span class="op">)</span>

<span class="co"># S4 method for data.frameOrSimilar,data.frameOrSimilar,Mass2MzParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, mzColname <span class="op">=</span> <span class="st">"mz"</span>, massColname <span class="op">=</span> <span class="st">"exactmass"</span><span class="op">)</span>

<span class="co"># S4 method for numeric,data.frameOrSimilar,MzParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, mzColname <span class="op">=</span> <span class="st">"mz"</span><span class="op">)</span>

<span class="co"># S4 method for data.frameOrSimilar,numeric,MzParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, mzColname <span class="op">=</span> <span class="st">"mz"</span><span class="op">)</span>

<span class="co"># S4 method for data.frameOrSimilar,data.frameOrSimilar,MzParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, mzColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"mz"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># S4 method for data.frameOrSimilar,data.frameOrSimilar,Mass2MzRtParam</span>
<span class="fu">matchMz</span><span class="op">(</span>
  <span class="va">query</span>,
  <span class="va">target</span>,
  <span class="va">param</span>,
  massColname <span class="op">=</span> <span class="st">"exactmass"</span>,
  mzColname <span class="op">=</span> <span class="st">"mz"</span>,
  rtColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"rt"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># S4 method for data.frameOrSimilar,data.frameOrSimilar,MzRtParam</span>
<span class="fu">matchMz</span><span class="op">(</span>
  <span class="va">query</span>,
  <span class="va">target</span>,
  <span class="va">param</span>,
  mzColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"mz"</span><span class="op">)</span>,
  rtColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"rt"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># S4 method for numeric,numeric,Mz2MassParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span><span class="op">)</span>

<span class="co"># S4 method for numeric,data.frameOrSimilar,Mz2MassParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, mzColname <span class="op">=</span> <span class="st">"mz"</span><span class="op">)</span>

<span class="co"># S4 method for data.frameOrSimilar,numeric,Mz2MassParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, mzColname <span class="op">=</span> <span class="st">"mz"</span><span class="op">)</span>

<span class="co"># S4 method for data.frameOrSimilar,data.frameOrSimilar,Mz2MassParam</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, mzColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"mz"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># S4 method for data.frameOrSimilar,data.frameOrSimilar,Mz2MassRtParam</span>
<span class="fu">matchMz</span><span class="op">(</span>
  <span class="va">query</span>,
  <span class="va">target</span>,
  <span class="va">param</span>,
  mzColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"mz"</span><span class="op">)</span>,
  rtColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"rt"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># S4 method for SummarizedExperiment,ANY,Param</span>
<span class="fu">matchMz</span><span class="op">(</span><span class="va">query</span>, <span class="va">target</span>, <span class="va">param</span>, mzColname <span class="op">=</span> <span class="st">"mz"</span>, rtColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"rt"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>tolerance</dt>
<dd><p>for any <code>param</code> object: <code>numeric(1)</code> defining the maximal
acceptable absolute difference in m/z (or in mass for <code>Mz2MassParam</code>)
to consider them <em>matching</em>.</p></dd>
<dt>ppm</dt>
<dd><p>for any <code>param</code> object: <code>numeric(1)</code> defining the maximal
acceptable m/z-dependent (or mass-dependent for <code>Mz2MassParam</code>)
difference (in parts-per-million) in m/z values to consider them to
be <em>matching</em>.</p></dd>
<dt>adducts</dt>
<dd><p>for <code>Mass2MzParam</code> or <code>Mass2MzRtParam</code>: either <code>character</code>
with adduct names from <code><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/adductNames.html" class="external-link">MetaboCoreUtils::adducts()</a></code> or <code>data.frame</code> with
a custom adduct definition. This parameter is used to calculate m/z from
target compounds' masses. Custom adduct definitions can be passed to the
adduct parameter in form of a <code>data.frame</code>. This <code>data.frame</code> is expected
to have columns <code>"mass_add"</code> and <code>"mass_multi"</code> defining the <em>additive</em>
and <em>multiplicative</em> part of the calculation. See
<code><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/adductNames.html" class="external-link">MetaboCoreUtils::adducts()</a></code> for the expected format or use
<code>MetaboCoreUtils::adductNames("positive")</code> and
<code>MetaboCoreUtils::adductNames("negative")</code> for valid adduct names.</p></dd>
<dt>toleranceRt</dt>
<dd><p>for <code>Mass2MzRtParam</code> or <code>MzRtParam</code>: <code>numeric(1)</code>
defining the maximal acceptable absolute difference in retention time
values to consider them them <em>matching</em>.</p></dd>
<dt>queryAdducts</dt>
<dd><p>for <code>Mz2MassParam</code>. Adducts used to derive mass
values from query m/z values. The expected format is the same as that
for parameter <code>adducts</code>.</p></dd>
<dt>targetAdducts</dt>
<dd><p>for <code>Mz2MassParam</code>. Adducts used to derive mass
values from target m/z values. The expected format is the same as that
for parameter <code>adducts</code>.</p></dd>
<dt>query</dt>
<dd><p>feature table containing information on MS1 features. Can be
a <code>data.frame</code>, <code>DataFrame</code>, <code>matrix</code>, <code>SummarizedExperiment</code> or
<code>numeric</code>. It is expected to contain m/z values and can contain also
other variables. Matchings based on both m/z and retention time can be
performed when a column with retention times is present in both <code>query</code>
and <code>target</code>.</p></dd>
<dt>target</dt>
<dd><p>compound table with metabolites to compare against.</p></dd>
<dt>param</dt>
<dd><p>parameter object defining the matching approach and containing
the settings for that approach. See description above for details.</p></dd>
<dt>...</dt>
<dd><p>currently ignored.</p></dd>
<dt>valueColname</dt>
<dd><p><code>character</code> specifying the name of the column in
<code>query</code> or/and the one in <code>target</code>with the desired values for the
matching. This parameter should only be used when <code>param</code> is
<code>valueParam</code> and in this case it must be provided (unless both <code>query</code>
and <code>target</code> are <code>numeric</code>). It can be <code>character(1)</code> or <code>character(2)</code>
in a similar way to <code>mzColname</code>.</p></dd>
<dt>massColname</dt>
<dd><p><code>character(1)</code> with the name of the column in <code>target</code>
containing the mass of compounds. To be used when <code>param</code> is
<code>Mass2MzParam</code> or <code>Mass2MzRtParam</code> (and target is not already <code>numeric</code>
with the masses). Defaults to <code>massColname = "exactmass"</code>.</p></dd>
<dt>mzColname</dt>
<dd><p><code>character</code> specifying the name(s) of the column(s) in
<code>query</code> or/and <code>target</code>with the m/z values. If one among <code>query</code> and
<code>target</code> is <code>numeric</code> (and therefore there is no need to specify the
column name) or <code>query</code> is not <code>numeric</code> and <code>param</code> is <code>Mass2MzParam</code>
or <code>Mass2MzRtParam</code> (and therefore the name of the column with m/z needs
only to be specified for <code>query</code>) then <code>mzColname</code> is expected to be
<code>character(1)</code>. If both <code>query</code> and <code>target</code> are not numeric <code>mzColname</code>
is expected to be <code>character(2)</code> (or <code>character(1)</code> and in this last case
the two column names are assumed to be the same). If not specified the
assumed default name for coulmns with m/z values is <code>"mz"</code>.</p></dd>
<dt>rtColname</dt>
<dd><p><code>character(2)</code> with the name of the column containing
the compounds retention times in <code>query</code> and the name for the one in
<code>target</code>. It can also be <code>character(1)</code> if the two names are the same.
To be used when <code>param</code> is <code>MzRtParam</code> or <code>Mass2MzRtParam</code>.
Defaults to <code>rtColname = c("rt", "rt")</code>.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><a href="Matched.html">Matched</a> object representing the result (or more precisely
<a href="Matched.html">MatchedSummarizedExperiment</a> if <code>query</code> is <code>SummarizedExperiment</code>).
To evaluate each match the object contains, depending on which <code>param</code> is
used, the m/z or mass error in ppm (variable <code>"ppm_error"</code>) as well as
the m/z or mass difference (variable <code>"score"</code>). When <code>param</code> is
<code>Mz2MassParam</code> such difference and ppm error are obtained using mass values
internally computed from m/z values in <code>query</code> and <code>target</code> (see above
for more detail on <code>Mz2MassParam</code>). When <code>parm</code> is either <code>MzParam</code>,
<code>MzRtParam</code>, <code>Mass2MzParam</code> or <code>Mass2MzRtParam</code><code>"ppm_error"</code> and <code>"score"</code>are computed from m/z values. In the first two cases both the m/z values are
contained in <code>query</code> and <code>target</code> parameters. In the last two m/z values are
internally computed from reference mass values in <code>target</code>. See more details
for each individual parameter above. Additionally, if <code>param</code> is either
<code>MzRtParam</code> or <code>Mass2MzRtParam</code> also retention time is used for the matching
and the difference in retention time for each of the matched elements is also
added to the returned <code>Matched</code> object. Note that, for a match, a negative
value of <code>"score"</code> (or <code>"score_rt"</code>) indicates that the m/z or mass (or
retention time) associated to the query element is smaller than that
associated to the target element.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="matchSpectra.html">matchSpectra</a> or <code><a href="CompareSpectraParam.html">CompareSpectraParam()</a></code> for spectra data matching</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Andrea Vicini, Michael Witting</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MetaboCoreUtils" class="external-link">MetaboCoreUtils</a></span><span class="op">)</span></span>
<span class="r-in"><span class="co">## Create a simple "target/reference" compound table</span></span>
<span class="r-in"><span class="va">target_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span class="r-in">   name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tryptophan"</span>, <span class="st">"Leucine"</span>, <span class="st">"Isoleucine"</span><span class="op">)</span>,</span>
<span class="r-in">   formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C11H12N2O2"</span>, <span class="st">"C6H13NO2"</span>, <span class="st">"C6H13NO2"</span><span class="op">)</span>,</span>
<span class="r-in">   exactmass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">204.089878</span>, <span class="fl">131.094629</span>, <span class="fl">131.094629</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Create a "feature" table with m/z of features. We calculate m/z for</span></span>
<span class="r-in"><span class="co">## certain adducts of some of the compounds in the reference table.</span></span>
<span class="r-in"><span class="va">fts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span class="r-in">    feature_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FT001"</span>, <span class="st">"FT002"</span>, <span class="st">"FT003"</span><span class="op">)</span>,</span>
<span class="r-in">    mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/mass2mz.html" class="external-link">mass2mz</a></span><span class="op">(</span><span class="fl">204.089878</span>, <span class="st">"[M+H]+"</span><span class="op">)</span>,</span>
<span class="r-in">           <span class="fu"><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/mass2mz.html" class="external-link">mass2mz</a></span><span class="op">(</span><span class="fl">131.094629</span>, <span class="st">"[M+H]+"</span><span class="op">)</span>,</span>
<span class="r-in">           <span class="fu"><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/mass2mz.html" class="external-link">mass2mz</a></span><span class="op">(</span><span class="fl">204.089878</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1e-6</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Define the parameters for the matching</span></span>
<span class="r-in"><span class="va">parm</span> <span class="op">&lt;-</span> <span class="fu">Mass2MzParam</span><span class="op">(</span></span>
<span class="r-in">    adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>,</span>
<span class="r-in">    tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span class="r-in">    ppm <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">matchMz</span><span class="op">(</span><span class="va">fts</span>, <span class="va">target_df</span>, <span class="va">parm</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class Matched </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of matches: 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of query objects: 3 (3 matched)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of target objects: 3 (3 matched)</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Get the full matching result:</span></span>
<span class="r-in"><span class="fu"><a href="Matched.html">matchedData</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 4 rows and 8 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      feature_id        mz target_name target_formula target_exactmass</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;character&gt; &lt;numeric&gt; &lt;character&gt;    &lt;character&gt;        &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         FT001   205.097  Tryptophan     C11H12N2O2          204.090</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         FT002   132.102     Leucine       C6H13NO2          131.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.1       FT002   132.102  Isoleucine       C6H13NO2          131.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         FT003   227.079  Tryptophan     C11H12N2O2          204.090</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          adduct     score  ppm_error</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;character&gt; &lt;numeric&gt;  &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        [M+H]+     0e+00 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        [M+H]+     0e+00 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.1      [M+H]+     0e+00 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       [M+Na]+     1e-06 0.00440375</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## We have thus matches of FT002 to two different compounds (but with the</span></span>
<span class="r-in"><span class="co">## same mass).</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## We repeat the matching requiring an exact match</span></span>
<span class="r-in"><span class="va">parm</span> <span class="op">&lt;-</span> <span class="fu">Mass2MzParam</span><span class="op">(</span></span>
<span class="r-in">    adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>,</span>
<span class="r-in">    tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span class="r-in">    ppm <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">matchMz</span><span class="op">(</span><span class="va">fts</span>, <span class="va">target_df</span>, <span class="va">parm</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class Matched </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of matches: 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of query objects: 3 (2 matched)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of target objects: 3 (3 matched)</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="Matched.html">matchedData</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 4 rows and 8 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      feature_id        mz target_name target_formula target_exactmass</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;character&gt; &lt;numeric&gt; &lt;character&gt;    &lt;character&gt;        &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         FT001   205.097  Tryptophan     C11H12N2O2          204.090</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         FT002   132.102     Leucine       C6H13NO2          131.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.1       FT002   132.102  Isoleucine       C6H13NO2          131.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         FT003   227.079          NA             NA               NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          adduct     score ppm_error</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        [M+H]+         0         0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        [M+H]+         0         0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.1      [M+H]+         0         0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            NA        NA        NA</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## The last feature could thus not be matched to any compound.</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## At last we use also different adduct definitions.</span></span>
<span class="r-in"><span class="va">parm</span> <span class="op">&lt;-</span> <span class="fu">Mass2MzParam</span><span class="op">(</span></span>
<span class="r-in">    adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+K]+"</span>, <span class="st">"[M+Li]+"</span><span class="op">)</span>,</span>
<span class="r-in">    tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span class="r-in">    ppm <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">matchMz</span><span class="op">(</span><span class="va">fts</span>, <span class="va">target_df</span>, <span class="va">parm</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class Matched </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of matches: 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of query objects: 3 (0 matched)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of target objects: 3 (0 matched)</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="Matched.html">matchedData</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 3 rows and 8 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    feature_id        mz target_name target_formula target_exactmass      adduct</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;character&gt; &lt;numeric&gt; &lt;character&gt;    &lt;character&gt;        &lt;numeric&gt; &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       FT001   205.097          NA             NA               NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       FT002   132.102          NA             NA               NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       FT003   227.079          NA             NA               NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       score ppm_error</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;numeric&gt; &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        NA        NA</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## No matches were found.</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## We can also match a "feature" table with a target data.frame taking into</span></span>
<span class="r-in"><span class="co">## account both m/z and retention time values.</span></span>
<span class="r-in"><span class="va">target_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span class="r-in">  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tryptophan"</span>, <span class="st">"Leucine"</span>, <span class="st">"Isoleucine"</span><span class="op">)</span>,</span>
<span class="r-in">  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C11H12N2O2"</span>, <span class="st">"C6H13NO2"</span>, <span class="st">"C6H13NO2"</span><span class="op">)</span>,</span>
<span class="r-in">  exactmass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">204.089878</span>, <span class="fl">131.094629</span>, <span class="fl">131.094629</span><span class="op">)</span>,</span>
<span class="r-in">  rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">140</span>, <span class="fl">140</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">fts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span class="r-in">  feature_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FT001"</span>, <span class="st">"FT002"</span>, <span class="st">"FT003"</span><span class="op">)</span>,</span>
<span class="r-in">  mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/mass2mz.html" class="external-link">mass2mz</a></span><span class="op">(</span><span class="fl">204.089878</span>, <span class="st">"[M+H]+"</span><span class="op">)</span>,</span>
<span class="r-in">         <span class="fu"><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/mass2mz.html" class="external-link">mass2mz</a></span><span class="op">(</span><span class="fl">131.094629</span>, <span class="st">"[M+H]+"</span><span class="op">)</span>,</span>
<span class="r-in">         <span class="fu"><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/mass2mz.html" class="external-link">mass2mz</a></span><span class="op">(</span><span class="fl">204.089878</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1e-6</span><span class="op">)</span>,</span>
<span class="r-in">  rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">140</span>, <span class="fl">150.1</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Define the parameters for the matching</span></span>
<span class="r-in"><span class="va">parm</span> <span class="op">&lt;-</span> <span class="fu">Mass2MzRtParam</span><span class="op">(</span></span>
<span class="r-in">  adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>,</span>
<span class="r-in">  tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span class="r-in">  ppm <span class="op">=</span> <span class="fl">20</span>,</span>
<span class="r-in">  toleranceRt <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">matchMz</span><span class="op">(</span><span class="va">fts</span>, <span class="va">target_df</span>, <span class="va">parm</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class Matched </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of matches: 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of query objects: 3 (2 matched)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of target objects: 3 (3 matched)</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Get the full matching result:</span></span>
<span class="r-in"><span class="fu"><a href="Matched.html">matchedData</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 4 rows and 11 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      feature_id        mz        rt target_name target_formula target_exactmass</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;character&gt;    &lt;character&gt;        &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         FT001   205.097     150.0  Tryptophan     C11H12N2O2          204.090</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         FT002   132.102     140.0     Leucine       C6H13NO2          131.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.1       FT002   132.102     140.0  Isoleucine       C6H13NO2          131.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         FT003   227.079     150.1          NA             NA               NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     target_rt      adduct     score ppm_error  score_rt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;numeric&gt; &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         150      [M+H]+         0         0         0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         140      [M+H]+         0         0         0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.1       140      [M+H]+         0         0         0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          NA          NA        NA        NA        NA</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## FT003 could not be matched to any compound, FT002 was matched to two</span></span>
<span class="r-in"><span class="co">## different compounds (but with the same mass).</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## We repeat the matching allowing a positive tolerance for the matches</span></span>
<span class="r-in"><span class="co">## between rt values</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Define the parameters for the matching</span></span>
<span class="r-in"><span class="va">parm</span> <span class="op">&lt;-</span> <span class="fu">Mass2MzRtParam</span><span class="op">(</span></span>
<span class="r-in">  adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>,</span>
<span class="r-in">  tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span class="r-in">  ppm <span class="op">=</span> <span class="fl">20</span>,</span>
<span class="r-in">  toleranceRt <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">matchMz</span><span class="op">(</span><span class="va">fts</span>, <span class="va">target_df</span>, <span class="va">parm</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class Matched </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of matches: 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of query objects: 3 (3 matched)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of target objects: 3 (3 matched)</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Get the full matching result:</span></span>
<span class="r-in"><span class="fu"><a href="Matched.html">matchedData</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 4 rows and 11 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      feature_id        mz        rt target_name target_formula target_exactmass</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;character&gt;    &lt;character&gt;        &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         FT001   205.097     150.0  Tryptophan     C11H12N2O2          204.090</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         FT002   132.102     140.0     Leucine       C6H13NO2          131.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.1       FT002   132.102     140.0  Isoleucine       C6H13NO2          131.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         FT003   227.079     150.1  Tryptophan     C11H12N2O2          204.090</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     target_rt      adduct     score  ppm_error  score_rt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;numeric&gt; &lt;character&gt; &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         150      [M+H]+     0e+00 0.00000000       0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         140      [M+H]+     0e+00 0.00000000       0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.1       140      [M+H]+     0e+00 0.00000000       0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         150     [M+Na]+     1e-06 0.00440375       0.1</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Also FT003 was matched in this case</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## It is also possible to match directly m/z values</span></span>
<span class="r-in"><span class="va">mz1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">343</span>, <span class="fl">23</span>, <span class="fl">231</span><span class="op">)</span></span>
<span class="r-in"><span class="va">mz2</span> <span class="op">&lt;-</span> <span class="va">mz1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span>, sd <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">matchMz</span><span class="op">(</span><span class="va">mz1</span>, <span class="va">mz2</span>, <span class="fu">MzParam</span><span class="op">(</span>tolerance <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="Matched.html">matchedData</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 4 rows and 4 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     query  target        score ppm_error</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;AsIs&gt;  &lt;AsIs&gt;    &lt;numeric&gt; &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NA     12      NA           NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     343 343.000 -1.14620e-04   0.33417</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      23  23.000  2.59175e-05   1.12685</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     231 231.001 -1.24756e-03   5.40068</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Michael Witting, Johannes Rainer, Andrea Vicini, Carolin
Huber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

